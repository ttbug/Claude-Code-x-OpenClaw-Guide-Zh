# Claude Agent SDK å®Œæ•´æŒ‡å—ï¼šæŠŠAIç¼–ç¨‹èƒ½åŠ›è£…è¿›ä½ çš„ç¨‹åºé‡Œ

> **è¯¾ç¨‹ä¿¡æ¯**
>
> - **ä½œè€…**ï¼šè€é‡‘
> - **é¢„è®¡å­¦æ—¶**ï¼š6-8å°æ—¶
> - **éš¾åº¦ç­‰çº§**ï¼šâ­â­â­ ä¸­çº§è¿›é˜¶
> - **æ›´æ–°æ—¥æœŸ**ï¼š2026å¹´2æœˆ
> - **é€‚ç”¨ç‰ˆæœ¬**ï¼šClaude Code v2.1+ï¼ˆéªŒè¯äº2026-02-25ï¼‰
> - **ä¿¡æ¯æ¥æº**ï¼š[å®˜æ–¹æ–‡æ¡£](https://docs.anthropic.com/en/docs/claude-code/sdk)ã€[GitHub Python SDK](https://github.com/anthropics/claude-agent-sdk-python)ã€[GitHub TypeScript SDK](https://github.com/anthropics/claude-agent-sdk-typescript)

> **ç‰ˆæœ¬è¯´æ˜**ï¼šClaude Agent SDKï¼ˆåŸåClaude Code SDKï¼‰æ˜¯2025å¹´Anthropicå®˜æ–¹å‘å¸ƒçš„å¼€å‘å·¥å…·åŒ…ã€‚æœ¬æ•™ç¨‹åŸºäºæœ€æ–°å®˜æ–¹æ–‡æ¡£ç¼–å†™ï¼Œå¦‚æœ‰æ›´æ–°è¯·ä»¥å®˜æ–¹ä¸ºå‡†ã€‚

---

## æœ¬è¯¾å­¦ä¹ ç›®æ ‡

å®Œæˆæœ¬è¯¾å­¦ä¹ åï¼Œä½ å°†èƒ½å¤Ÿï¼š

1. **ç†è§£SDKçš„æ ¸å¿ƒä»·å€¼**ï¼šæŒæ¡Agent SDKä¸Claude Code CLIçš„å…³ç³»å’Œå®šä½
2. **5åˆ†é’Ÿå¿«é€Ÿä¸Šæ‰‹**ï¼šå®ŒæˆHello World Agentçš„åˆ›å»ºå’Œè¿è¡Œ
3. **æŒæ¡æ ¸å¿ƒæ¦‚å¿µ**ï¼šæ·±å…¥ç†è§£Toolsã€Agent Loopã€Context Management
4. **ç‹¬ç«‹å®Œæˆ3ä¸ªå®æˆ˜é¡¹ç›®**ï¼šä»one-shotåˆ°multi-toolå†åˆ°streamingæ¨¡å¼
5. **è‡ªå®šä¹‰å·¥å…·å¼€å‘**ï¼šåˆ›å»ºSDKå†…ç½®MCPæœåŠ¡å™¨ï¼Œæ‰©å±•Agentèƒ½åŠ›
6. **æ•…éšœæ’æŸ¥æŠ€èƒ½**ï¼šç‹¬ç«‹è§£å†³90%çš„å¸¸è§é—®é¢˜

---

## å­¦ä¹ è·¯å¾„å¯¼èˆªï¼ˆå…ˆçœ‹è¿™é‡Œï¼ï¼‰

> è¿™æ˜¯ä¸€ç¯‡é•¿æ•™ç¨‹ï¼Œä¸ç”¨å…¨çœ‹ï¼æ ¹æ®ä½ çš„ç›®æ ‡é€‰æ‹©è·¯å¾„ã€‚

### è·¯å¾„Aï¼šå¿«é€Ÿä½“éªŒï¼ˆ60åˆ†é’Ÿï¼‰

**é€‚åˆäººç¾¤**ï¼šæ€¥ç€ä½“éªŒAgent SDKï¼Œæƒ³å¿«é€Ÿè·‘ä¸ªDemo

**åªçœ‹è¿™äº›ç« èŠ‚**ï¼š

```
æœ¯è¯­è¡¨ï¼ˆ5åˆ†é’Ÿï¼‰
ç¬¬ä¸€éƒ¨åˆ†ï¼šSDKç®€ä»‹ï¼ˆ10åˆ†é’Ÿï¼‰
ç¬¬äºŒéƒ¨åˆ†ï¼š5åˆ†é’Ÿå¿«é€Ÿå¼€å§‹ï¼ˆ20åˆ†é’Ÿï¼‰
å®æˆ˜é¡¹ç›®1ï¼šHello World Agentï¼ˆ25åˆ†é’Ÿï¼‰
```

**60åˆ†é’Ÿåä½ èƒ½è¾¾åˆ°**ï¼šæˆåŠŸè¿è¡Œç¬¬ä¸€ä¸ªAgentï¼Œç†è§£åŸºæœ¬å·¥ä½œæµç¨‹

---

### è·¯å¾„Bï¼šç³»ç»Ÿå­¦ä¹ ï¼ˆ6-8å°æ—¶ï¼‰

**é€‚åˆäººç¾¤**ï¼šæƒ³æ·±å…¥æŒæ¡Agent SDKï¼Œå‡†å¤‡åœ¨é¡¹ç›®ä¸­ä½¿ç”¨

**å­¦ä¹ é¡ºåº**ï¼šä»å¤´åˆ°å°¾æ‰€æœ‰ç« èŠ‚

**å»ºè®®åˆ†æ®µå­¦ä¹ **ï¼š
- ç¬¬1å¤©ï¼ˆ2å°æ—¶ï¼‰ï¼šç¬¬ä¸€~ä¸‰éƒ¨åˆ†ï¼ˆæ¦‚å¿µ+å®‰è£…+æ ¸å¿ƒåŸç†ï¼‰
- ç¬¬2å¤©ï¼ˆ2å°æ—¶ï¼‰ï¼šç¬¬å››éƒ¨åˆ†ï¼ˆ3ä¸ªå®æˆ˜é¡¹ç›®ï¼‰
- ç¬¬3å¤©ï¼ˆ2å°æ—¶ï¼‰ï¼šç¬¬äº”~å…­éƒ¨åˆ†ï¼ˆé«˜çº§åŠŸèƒ½+æ•…éšœæ’æŸ¥ï¼‰
- ç¬¬4å¤©ï¼ˆ1å°æ—¶ï¼‰ï¼šç¬¬ä¸ƒéƒ¨åˆ†FAQ + æ€»å¤ä¹ 

---

### è·¯å¾„Cï¼šé—®é¢˜é€ŸæŸ¥ï¼ˆ5åˆ†é’Ÿï¼‰

**é€‚åˆäººç¾¤**ï¼šä½¿ç”¨ä¸­é‡åˆ°é—®é¢˜ï¼Œéœ€è¦å¿«é€Ÿè§£å†³

**ç›´æ¥è·³åˆ°**ï¼š

```
ç¬¬å…­éƒ¨åˆ†ï¼šæ•…éšœæ’æŸ¥ - æŒ‰é”™è¯¯ç±»å‹æŸ¥æ‰¾è§£å†³æ–¹æ¡ˆ
ç¬¬ä¸ƒéƒ¨åˆ†ï¼šFAQ - 20ä¸ªç²¾é€‰é—®é¢˜
```

---

### è·¯å¾„Dï¼šä¸“é¡¹å­¦ä¹ ï¼ˆ30-60åˆ†é’Ÿ/ä¸»é¢˜ï¼‰

**é€‚åˆäººç¾¤**ï¼šå·²ç»ä¼šåŸºç¡€ï¼Œæƒ³æ·±å…¥æŸä¸ªåŠŸèƒ½

| æƒ³å­¦ä»€ä¹ˆ | çœ‹å“ªå‡ èŠ‚ | é¢„è®¡æ—¶é—´ |
|----------|---------|---------|
| **è‡ªå®šä¹‰å·¥å…·** | ç¬¬ä¸‰éƒ¨åˆ†3.3èŠ‚ + ç¬¬å››éƒ¨åˆ†é¡¹ç›®3 | 60åˆ†é’Ÿ |
| **Hooksé’©å­** | ç¬¬äº”éƒ¨åˆ†5.2èŠ‚ | 45åˆ†é’Ÿ |
| **å­ä»£ç†å¹¶è¡Œ** | ç¬¬ä¸‰éƒ¨åˆ†3.4èŠ‚ + ç¬¬å››éƒ¨åˆ†é¡¹ç›®3 | 60åˆ†é’Ÿ |
| **MCPé›†æˆ** | ç¬¬äº”éƒ¨åˆ†5.1èŠ‚ | 45åˆ†é’Ÿ |

---

## æœ¯è¯­è¡¨ï¼ˆå°ç™½å¿…è¯»ï¼‰

åœ¨å¼€å§‹ä¹‹å‰ï¼Œå…ˆäº†è§£è¿™äº›å…³é”®æœ¯è¯­ã€‚**ä¸ç†è§£æœ¯è¯­ä¼šå½±å“åç»­å­¦ä¹ **ï¼

| æœ¯è¯­ | è‹±æ–‡å…¨ç§° | é€šä¿—è§£é‡Š |
|------|----------|----------|
| **SDK** | Software Development Kit | è½¯ä»¶å¼€å‘å·¥å…·åŒ…ï¼Œå°±åƒä¸€ä¸ª"å·¥å…·ç®±"ï¼Œé‡Œé¢æœ‰å„ç§ä½ éœ€è¦çš„é›¶ä»¶å’Œå·¥å…·ï¼Œè®©ä½ èƒ½æ›´æ–¹ä¾¿åœ°é€ ä¸œè¥¿ |
| **Agent** | - | æ™ºèƒ½ä»£ç†/è‡ªåŠ¨æœºå™¨äººï¼Œèƒ½å¤Ÿè‡ªä¸»å®Œæˆä»»åŠ¡çš„AIç¨‹åºã€‚å°±åƒä¸€ä¸ªä¼šæ€è€ƒçš„æœºå™¨äººåŠ©æ‰‹ï¼Œä½ ç»™å®ƒä»»åŠ¡ï¼Œå®ƒè‡ªå·±æƒ³åŠæ³•å®Œæˆ |
| **Agent Loop** | - | ä»£ç†å¾ªç¯ï¼ŒAgentå·¥ä½œçš„æ ¸å¿ƒæµç¨‹ï¼šæ¥æ”¶ä»»åŠ¡â†’æ€è€ƒâ†’ä½¿ç”¨å·¥å…·â†’æ£€æŸ¥ç»“æœâ†’ç»§ç»­æˆ–ç»“æŸã€‚å°±åƒä¸€ä¸ª"å·¥ä½œå¾ªç¯" |
| **Tool** | - | å·¥å…·ï¼ŒAgentå¯ä»¥è°ƒç”¨çš„èƒ½åŠ›ï¼Œæ¯”å¦‚è¯»æ–‡ä»¶ã€å†™æ–‡ä»¶ã€æ‰§è¡Œå‘½ä»¤ç­‰ã€‚å°±åƒæœºå™¨äººçš„"æ‰‹"å’Œ"çœ¼ç›" |
| **Hook** | - | é’©å­ï¼Œåœ¨ç‰¹å®šæ—¶æœºè‡ªåŠ¨è§¦å‘çš„å›è°ƒå‡½æ•°ã€‚å°±åƒè®¾ç½®çš„"è‡ªåŠ¨æŠ¥è­¦å™¨"ï¼Œç‰¹å®šäº‹ä»¶å‘ç”Ÿæ—¶è‡ªåŠ¨æ‰§è¡Œ |
| **MCP** | Model Context Protocol | æ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼Œè®©Agentè¿æ¥å¤–éƒ¨å·¥å…·çš„æ ‡å‡†åè®®ã€‚å°±åƒUSBæ¥å£æ ‡å‡†ï¼Œè®©å„ç§è®¾å¤‡èƒ½ç»Ÿä¸€æ¥å…¥ |
| **Stream/Streaming** | - | æµå¼ä¼ è¾“ï¼Œæ•°æ®åƒæµæ°´ä¸€æ ·ä¸€ç‚¹ç‚¹ä¼ è¿‡æ¥ï¼Œè€Œä¸æ˜¯ç­‰å…¨éƒ¨å®Œæˆæ‰ä¸€æ¬¡æ€§ä¼ è¾“ã€‚å°±åƒçœ‹è§†é¢‘è¾¹åŠ è½½è¾¹æ’­æ”¾ |
| **Async/Await** | - | å¼‚æ­¥ç¼–ç¨‹è¯­æ³•ï¼Œè®©ç¨‹åºä¸ç”¨å‚»ç­‰ï¼Œå¯ä»¥åŒæ—¶å¤„ç†å¤šä»¶äº‹ã€‚å°±åƒä½ ç­‰å¤–å–æ—¶è¿˜èƒ½çœ‹æ‰‹æœºï¼Œä¸ç”¨å‚»ç«™ç€ |
| **Iterator** | - | è¿­ä»£å™¨ï¼Œä¸€ç§å¯ä»¥é€ä¸ªè·å–æ•°æ®çš„å¯¹è±¡ã€‚å°±åƒè‡ªåŠ¨å‘ç‰Œæœºï¼Œæ¯æ¬¡ç»™ä½ ä¸€å¼ ç‰Œ |
| **Context** | - | ä¸Šä¸‹æ–‡ï¼ŒAIç†è§£å¯¹è¯çš„èƒŒæ™¯ä¿¡æ¯ã€‚å°±åƒèŠå¤©è®°å½•ï¼ŒAIé€šè¿‡å®ƒçŸ¥é“ä½ ä¹‹å‰è¯´äº†ä»€ä¹ˆ |
| **Token** | - | è®¡è´¹å•ä½ï¼ŒAIå¤„ç†æ–‡å­—çš„æœ€å°å•å…ƒã€‚çº¦ç­‰äº0.75ä¸ªè‹±æ–‡å•è¯æˆ–1-2ä¸ªæ±‰å­— |
| **Subagent** | - | å­ä»£ç†ï¼Œç”±ä¸»Agentåˆ›å»ºçš„å­ä»»åŠ¡æ‰§è¡Œè€…ã€‚å°±åƒä¸»ç®¡æ´¾å‡ºå»å¹²æ´»çš„å‘˜å·¥ |

---

## ç¬¬ä¸€éƒ¨åˆ†ï¼šClaude Agent SDK ç®€ä»‹

### 1.1 ä»€ä¹ˆæ˜¯ Claude Agent SDK

**ç”¨ä¸€å¥è¯è¯´**ï¼šClaude Agent SDKæ˜¯Anthropicå®˜æ–¹æä¾›çš„å¼€å‘å·¥å…·åŒ…ï¼Œè®©ä½ èƒ½å¤Ÿåœ¨è‡ªå·±çš„Pythonæˆ–TypeScriptç¨‹åºä¸­ä½¿ç”¨Claude Codeçš„å…¨éƒ¨èƒ½åŠ›ã€‚

**ç”Ÿæ´»ç±»æ¯”**ï¼š

æƒ³è±¡Claude Codeæ˜¯ä¸€è¾†è£…é…å®Œæ•´çš„æ±½è½¦ï¼Œä½ å¯ä»¥å¼€ç€å®ƒåˆ°å¤„è·‘ã€‚è€ŒAgent SDKå°±æ˜¯è¿™è¾†è½¦çš„å‘åŠ¨æœºã€å˜é€Ÿç®±å’Œåº•ç›˜çš„ç»„åˆåŒ…ï¼Œè®©ä½ èƒ½å¤Ÿæ‰“é€ å±äºè‡ªå·±çš„å®šåˆ¶è½¦å‹ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 ä½ çš„åº”ç”¨ç¨‹åº                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚           Claude Agent SDK               â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚       Claude Codeæ ¸å¿ƒå¼•æ“           â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  - æ–‡ä»¶è¯»å†™èƒ½åŠ›                      â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  - Bashå‘½ä»¤æ‰§è¡Œ                      â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  - ä»£ç åˆ†æä¸ç”Ÿæˆ                    â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  - ç½‘ç»œæœç´¢                          â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  - MCPå·¥å…·è°ƒç”¨                       â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 SDK vs CLIï¼šä»€ä¹ˆæ—¶å€™ç”¨å“ªä¸ªï¼Ÿ

Claude Codeæœ‰ä¸¤ç§ä½¿ç”¨æ–¹å¼ï¼Œé€‰æ‹©å–å†³äºä½ çš„åœºæ™¯ï¼š

```
                    Claudeä»£ç†æ ¸å¿ƒèƒ½åŠ›
                          â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                               â”‚
    Claude Code CLI                 Claude Agent SDK
    ï¼ˆå‘½ä»¤è¡Œå·¥å…·ï¼‰                    ï¼ˆç¼–ç¨‹æ¥å£ï¼‰
          â”‚                               â”‚
    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
    â”‚           â”‚                 â”‚               â”‚
  äººå·¥äº¤äº’   Shellè„šæœ¬          Pythonç¨‹åº     TypeScriptç¨‹åº
```

**å¯¹æ¯”è¡¨**ï¼š

| ç‰¹æ€§ | Claude Code CLI | Claude Agent SDK |
|------|-----------------|------------------|
| **ä½¿ç”¨æ–¹å¼** | åœ¨ç»ˆç«¯é‡Œè¾“å…¥å‘½ä»¤ | åœ¨ä»£ç é‡Œè°ƒç”¨å‡½æ•° |
| **é€‚åˆåœºæ™¯** | æ—¥å¸¸å¼€å‘ã€å¿«é€Ÿä»»åŠ¡ | è‡ªåŠ¨åŒ–ã€æ‰¹å¤„ç†ã€é›†æˆåˆ°ç³»ç»Ÿ |
| **äº¤äº’æ–¹å¼** | äººå·¥å¯¹è¯ | ç¨‹åºæ§åˆ¶ |
| **å¹¶å‘èƒ½åŠ›** | å•ä¼šè¯ | å¤šä»£ç†å¹¶è¡Œ |
| **å®šåˆ¶ç¨‹åº¦** | é…ç½®æ–‡ä»¶ | å®Œå…¨å¯ç¼–ç¨‹ |
| **å­¦ä¹ æ›²çº¿** | ä½ï¼ˆä¼šæ‰“å­—å°±è¡Œï¼‰ | ä¸­ï¼ˆéœ€è¦ç¼–ç¨‹åŸºç¡€ï¼‰ |

**ä»€ä¹ˆæ—¶å€™ç”¨SDKï¼Ÿ**

1. **è‡ªåŠ¨åŒ–è„šæœ¬**ï¼šæ¯å¤©è‡ªåŠ¨å®¡æŸ¥ä»£ç ã€ç”ŸæˆæŠ¥å‘Š
2. **æ‰¹é‡å¤„ç†**ï¼šä¸€æ¬¡å¤„ç†100ä¸ªæ–‡ä»¶çš„é‡æ„
3. **ç³»ç»Ÿé›†æˆ**ï¼šæŠŠClaudeåµŒå…¥ä½ çš„CI/CDæµç¨‹
4. **å¤šAgentåä½œ**ï¼šè®©å¤šä¸ªAgentå¹¶è¡Œå·¥ä½œ
5. **å®šåˆ¶åŒ–å·¥å…·**ï¼šæ„å»ºç‰¹å®šé¢†åŸŸçš„AIåŠ©æ‰‹

**ä»€ä¹ˆæ—¶å€™ç”¨CLIï¼Ÿ**

1. **æ—¥å¸¸å¼€å‘**ï¼šå†™ä»£ç ã€æ”¹bugã€é—®é—®é¢˜
2. **å¿«é€Ÿä»»åŠ¡**ï¼šä¸´æ—¶éœ€è¦AIå¸®å¿™çš„å°äº‹
3. **å­¦ä¹ æ¢ç´¢**ï¼šç†Ÿæ‚‰Claudeçš„èƒ½åŠ›
4. **ä¸æƒ³å†™ä»£ç **ï¼šå°±æƒ³ç®€å•èŠèŠ

### 1.3 æ”¯æŒçš„ç¼–ç¨‹è¯­è¨€

Agent SDKç›®å‰å®˜æ–¹æ”¯æŒä¸¤ç§è¯­è¨€ï¼Œé€‰æ‹©ä½ ç†Ÿæ‚‰çš„å³å¯ï¼š

**Python SDK**

```bash
# å®‰è£…å‘½ä»¤
pip install claude-agent-sdk

# ç‰¹ç‚¹
- Python 3.10+ æ”¯æŒ
- å¼‚æ­¥è¿­ä»£å™¨ï¼ˆasync forï¼‰
- ç±»å‹æç¤ºå®Œå–„
- é€‚åˆï¼šæ•°æ®ç§‘å­¦ã€AI/MLå·¥ä½œæµã€è‡ªåŠ¨åŒ–è„šæœ¬
```

**TypeScript/JavaScript SDK**

```bash
# å®‰è£…å‘½ä»¤
npm install @anthropic-ai/claude-agent-sdk

# ç‰¹ç‚¹
- Node.js 18+ æ”¯æŒ
- åŸç”Ÿå¼‚æ­¥ç”Ÿæˆå™¨
- å®Œæ•´ç±»å‹å®šä¹‰
- é€‚åˆï¼šWebåº”ç”¨ã€Node.jsæœåŠ¡ç«¯ã€å…¨æ ˆå¼€å‘
```

> **è€é‡‘å»ºè®®**ï¼šä¸¤ç§SDKåŠŸèƒ½å®Œå…¨ç›¸åŒï¼Œé€‰ä½ æœ€ç†Ÿæ‚‰çš„è¯­è¨€å°±å¥½ã€‚æœ¬æ•™ç¨‹ä¼šåŒæ—¶å±•ç¤ºä¸¤ç§è¯­è¨€çš„ä»£ç ç¤ºä¾‹ã€‚

### 1.4 ç‰ˆæœ¬æ¼”è¿›è¯´æ˜

Claude Agent SDKç»å†äº†ä»"Claude Code SDK"åˆ°"Agent SDK"çš„å“ç‰Œå‡çº§ï¼š

| ç‰ˆæœ¬é˜¶æ®µ | åŒ…å | çŠ¶æ€ |
|---------|------|------|
| æ—©æœŸ | `@anthropic-ai/claude-code` / `claude-code-sdk` | å·²å¼ƒç”¨ |
| å½“å‰ | `@anthropic-ai/claude-agent-sdk` / `claude-agent-sdk` | æ¨èä½¿ç”¨ |

**å¦‚æœä½ ä¹‹å‰ç”¨æ—§ç‰ˆSDK**ï¼Œéœ€è¦æ›´æ–°å¯¼å…¥è¯­å¥ï¼š

```python
# Pythonæ—§ç‰ˆï¼ˆå·²å¼ƒç”¨ï¼‰
from claude_code_sdk import query, ClaudeCodeOptions

# Pythonæ–°ç‰ˆï¼ˆæ¨èï¼‰
from claude_agent_sdk import query, ClaudeAgentOptions
```

```typescript
// TypeScriptæ—§ç‰ˆï¼ˆå·²å¼ƒç”¨ï¼‰
import { query } from '@anthropic-ai/claude-code';

// TypeScriptæ–°ç‰ˆï¼ˆæ¨èï¼‰
import { query } from '@anthropic-ai/claude-agent-sdk';
```

---

## ç¬¬äºŒéƒ¨åˆ†ï¼š5åˆ†é’Ÿå¿«é€Ÿå¼€å§‹

### 2.1 ç¯å¢ƒå‡†å¤‡

**ç³»ç»Ÿè¦æ±‚**ï¼š

| è¦æ±‚é¡¹ | æœ€ä½ç‰ˆæœ¬ | æ¨èç‰ˆæœ¬ |
|--------|---------|---------|
| **Node.js**ï¼ˆTypeScriptç”¨ï¼‰ | 18.0.0 | 20.x LTS |
| **Python**ï¼ˆPythonç”¨ï¼‰ | 3.10 | 3.11+ |
| **æ“ä½œç³»ç»Ÿ** | Windows 10/macOS 12/Ubuntu 20.04 | æœ€æ–°ç¨³å®šç‰ˆ |

**å¿«é€Ÿæ£€æŸ¥å‘½ä»¤**ï¼š

```bash
# æ£€æŸ¥Node.jsç‰ˆæœ¬
node --version
# åº”æ˜¾ç¤º v18.0.0 æˆ–æ›´é«˜

# æ£€æŸ¥Pythonç‰ˆæœ¬
python --version
# åº”æ˜¾ç¤º Python 3.10 æˆ–æ›´é«˜

# æ£€æŸ¥npmç‰ˆæœ¬
npm --version
# åº”æ˜¾ç¤º 8.0.0 æˆ–æ›´é«˜
```

### 2.2 å®‰è£…SDK

**Pythonå®‰è£…ï¼ˆæ¨èæ–¹å¼ï¼‰**ï¼š

```bash
# æ­¥éª¤1ï¼šåˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆæ¨èï¼‰
python -m venv venv

# æ­¥éª¤2ï¼šæ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
# Windows:
venv\Scripts\activate
# macOS/Linux:
source venv/bin/activate

# æ­¥éª¤3ï¼šå®‰è£…Agent SDK
pip install claude-agent-sdk
```

> **é‡è¦æç¤º**ï¼šPython SDKä¼šè‡ªåŠ¨æ†ç»‘Claude Code CLIï¼Œæ— éœ€å•ç‹¬å®‰è£…ï¼

**TypeScriptå®‰è£…**ï¼š

```bash
# æ­¥éª¤1ï¼šåˆ›å»ºé¡¹ç›®ç›®å½•
mkdir my-agent-project
cd my-agent-project

# æ­¥éª¤2ï¼šåˆå§‹åŒ–é¡¹ç›®
npm init -y

# æ­¥éª¤3ï¼šå®‰è£…Agent SDK
npm install @anthropic-ai/claude-agent-sdk

# æ­¥éª¤4ï¼šå®‰è£…TypeScriptå¼€å‘ä¾èµ–
npm install -D typescript @types/node ts-node
```

### 2.3 é…ç½®APIå¯†é’¥

Agent SDKéœ€è¦Anthropic APIå¯†é’¥æ‰èƒ½è¿è¡Œã€‚

**æ–¹å¼ä¸€ï¼šç¯å¢ƒå˜é‡ï¼ˆæ¨èï¼‰**

```bash
# Linux/macOS
export ANTHROPIC_API_KEY="sk-ant-api03-..."

# Windows PowerShell
$env:ANTHROPIC_API_KEY="sk-ant-api03-..."

# Windows CMD
set ANTHROPIC_API_KEY=sk-ant-api03-...
```

**æ–¹å¼äºŒï¼š.envæ–‡ä»¶**

åˆ›å»º`.env`æ–‡ä»¶ï¼š

```env
ANTHROPIC_API_KEY=sk-ant-api03-...
```

åœ¨ä»£ç ä¸­åŠ è½½ï¼š

```python
# Python
from dotenv import load_dotenv
load_dotenv()
```

```typescript
// TypeScript
import 'dotenv/config';
```

### 2.4 Hello World Agent

ç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºç¬¬ä¸€ä¸ªAgentï¼

**Pythonç‰ˆæœ¬** - åˆ›å»º`hello_agent.py`ï¼š

```python
import asyncio
from claude_agent_sdk import query, ClaudeAgentOptions

async def main():
    print('å¯åŠ¨Agent...')

    # é…ç½®é€‰é¡¹
    options = ClaudeAgentOptions(
        model='claude-sonnet-4-5-20250929'  # Sonnet 4.5ï¼ˆæ¨èæ¨¡å‹ï¼‰
    )

    # æ‰§è¡ŒæŸ¥è¯¢ï¼Œè¿”å›æµå¼å“åº”
    async for message in query(
        prompt='ä½ å¥½ï¼è¯·ç”¨ä¸€å¥è¯ä»‹ç»ä½ èƒ½åšä»€ä¹ˆï¼Ÿ',
        options=options
    ):
        # å¤„ç†åŠ©æ‰‹å›å¤
        if message.type == 'assistant':
            for block in message.content:
                if block.type == 'text':
                    print(block.text, end='', flush=True)

    print('\n\nAgentä»»åŠ¡å®Œæˆï¼')

if __name__ == '__main__':
    asyncio.run(main())
```

**è¿è¡Œ**ï¼š

```bash
python hello_agent.py
```

**é¢„æœŸè¾“å‡º**ï¼š

```
å¯åŠ¨Agent...
æˆ‘æ˜¯Claudeï¼Œä¸€ä¸ªAIåŠ©æ‰‹ï¼Œèƒ½å¸®ä½ ç¼–å†™ä»£ç ã€åˆ†ææ–‡ä»¶ã€æ‰§è¡Œå‘½ä»¤å’Œè§£ç­”å„ç§æŠ€æœ¯é—®é¢˜ã€‚

Agentä»»åŠ¡å®Œæˆï¼
```

---

**TypeScriptç‰ˆæœ¬** - åˆ›å»º`src/hello-agent.ts`ï¼š

```typescript
import { query, type Query } from '@anthropic-ai/claude-agent-sdk';

async function main() {
  console.log('å¯åŠ¨Agent...');

  // åˆ›å»ºæŸ¥è¯¢
  const stream: Query = query({
    prompt: 'ä½ å¥½ï¼è¯·ç”¨ä¸€å¥è¯ä»‹ç»ä½ èƒ½åšä»€ä¹ˆï¼Ÿ',
    options: {
      model: 'claude-sonnet-4-5-20250929'  // Sonnet 4.5(æ¨è)
    }
  });

  // å¤„ç†æµå¼å“åº”
  for await (const message of stream) {
    if (message.type === 'assistant') {
      for (const block of message.message.content) {
        if (block.type === 'text') {
          process.stdout.write(block.text);
        }
      }
    }
  }

  console.log('\n\nAgentä»»åŠ¡å®Œæˆï¼');
}

main().catch(console.error);
```

**è¿è¡Œ**ï¼š

```bash
npx ts-node src/hello-agent.ts
```

### 2.5 éªŒè¯å®‰è£…æˆåŠŸ

å¦‚æœä½ çœ‹åˆ°äº†Agentçš„å›å¤ï¼Œæ­å–œï¼å®‰è£…æˆåŠŸï¼

**å¸¸è§é—®é¢˜å¿«é€Ÿæ’æŸ¥**ï¼š

| é”™è¯¯ä¿¡æ¯ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|---------|------|---------|
| `ModuleNotFoundError: No module named 'claude_agent_sdk'` | SDKæ²¡è£…å¥½ | é‡æ–°è¿è¡Œ `pip install claude-agent-sdk` |
| `Cannot find module '@anthropic-ai/claude-agent-sdk'` | npmåŒ…æ²¡è£…å¥½ | é‡æ–°è¿è¡Œ `npm install` |
| `Authentication failed` | API Keyæ²¡é…ç½® | æ£€æŸ¥ç¯å¢ƒå˜é‡æ˜¯å¦è®¾ç½®æ­£ç¡® |
| `Connection timeout` | ç½‘ç»œé—®é¢˜ | æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼Œå›½å†…å¯èƒ½éœ€è¦ä»£ç† |

---

## ç¬¬ä¸‰éƒ¨åˆ†ï¼šæ ¸å¿ƒæ¦‚å¿µæ·±åº¦è§£æ

### 3.1 queryå‡½æ•°ï¼šSDKçš„æ ¸å¿ƒå…¥å£

`query`å‡½æ•°æ˜¯Agent SDKçš„å¿ƒè„ï¼Œç†è§£å®ƒå°±ç†è§£äº†SDKçš„ä¸€åŠã€‚

**å‡½æ•°ç­¾å**ï¼š

```python
# Python
async def query(
    prompt: str,
    options: Optional[ClaudeAgentOptions] = None
) -> AsyncIterator[SDKMessage]:
```

```typescript
// TypeScript
function query(params: {
  prompt: string | AsyncIterable<SDKUserMessage>;
  options?: QueryOptions;
}): Query;
```

**æ ¸å¿ƒå‚æ•°è¯´æ˜**ï¼š

| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| `prompt` | string | æ˜¯ | å‘é€ç»™Agentçš„æç¤ºè¯/ä»»åŠ¡æè¿° |
| `options` | Optionså¯¹è±¡ | å¦ | Agentçš„é…ç½®é€‰é¡¹ |

**Optionsé…ç½®é¡¹è¯¦è§£**ï¼š

```python
# Pythonå®Œæ•´é…ç½®ç¤ºä¾‹
from claude_agent_sdk import ClaudeAgentOptions

options = ClaudeAgentOptions(
    # æ¨¡å‹é€‰æ‹©
    model='claude-sonnet-4-5-20250929',  # Sonnet 4.5(æ¨è),ä¹Ÿå¯é€‰Opus 4.5æˆ–Haiku 3.5

    # ç³»ç»Ÿæç¤ºè¯ï¼ˆå®šä¹‰Agentçš„è§’è‰²å’Œè¡Œä¸ºï¼‰
    system_prompt='ä½ æ˜¯ä¸€ä¸ªPythonä¸“å®¶ï¼Œä¸“æ³¨äºä»£ç è´¨é‡å’Œæœ€ä½³å®è·µã€‚',

    # å·¥ä½œç›®å½•ï¼ˆAgentæ“ä½œæ–‡ä»¶çš„æ ¹ç›®å½•ï¼‰
    cwd='/path/to/your/project',

    # æœ€å¤§å¯¹è¯è½®æ¬¡ï¼ˆé˜²æ­¢æ— é™å¾ªç¯ï¼‰
    max_turns=10,

    # æƒé™æ¨¡å¼
    permission_mode='default',  # å¯é€‰ï¼šdefault, acceptEdits, bypassPermissions

    # å…è®¸ä½¿ç”¨çš„å·¥å…·
    allowed_tools=['Read', 'Write', 'Edit', 'Bash', 'Glob', 'Grep'],

    # MCPæœåŠ¡å™¨é…ç½®ï¼ˆæ‰©å±•å·¥å…·ï¼‰
    mcp_servers={
        'my_server': {
            'command': 'python',
            'args': ['-m', 'my_mcp_server']
        }
    }
)
```

**è¿”å›å€¼ï¼šæµå¼æ¶ˆæ¯**

`query`è¿”å›ä¸€ä¸ªå¼‚æ­¥è¿­ä»£å™¨ï¼Œäº§ç”Ÿå¤šç§ç±»å‹çš„æ¶ˆæ¯ï¼š

```python
# æ¶ˆæ¯ç±»å‹
SDKMessage = Union[
    AssistantMessage,   # AIçš„å›å¤
    UserMessage,        # ç”¨æˆ·çš„è¾“å…¥
    ToolUseBlock,       # å·¥å…·è°ƒç”¨è¯·æ±‚
    ToolResultBlock,    # å·¥å…·æ‰§è¡Œç»“æœ
    ResultMessage,      # æœ€ç»ˆç»“æœ
]
```

**å¤„ç†æ¶ˆæ¯çš„æ ‡å‡†æ¨¡å¼**ï¼š

```python
async for message in query(prompt="ä½ çš„ä»»åŠ¡", options=options):
    if isinstance(message, AssistantMessage):
        # å¤„ç†AIå›å¤
        for block in message.content:
            if isinstance(block, TextBlock):
                print(block.text)
            elif isinstance(block, ToolUseBlock):
                print(f"è°ƒç”¨å·¥å…·: {block.name}")

    elif isinstance(message, ResultMessage):
        # ä»»åŠ¡å®Œæˆ
        print(f"æœ€ç»ˆç»“æœ: {message.result}")
```

### 3.2 Agent Loopï¼šä»£ç†çš„å·¥ä½œå¾ªç¯

Agentä¸æ˜¯ç®€å•åœ°"é—®ä¸€å¥ç­”ä¸€å¥"ï¼Œè€Œæ˜¯æœ‰ä¸€ä¸ªå®Œæ•´çš„å·¥ä½œå¾ªç¯ã€‚

**Agent Loopå·¥ä½œæµç¨‹**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Agent Loop                         â”‚
â”‚                                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚   â”‚ æ¥æ”¶ä»»åŠ¡ â”‚ â†’ â”‚  æ€è€ƒ   â”‚ â†’ â”‚ å†³å®šè¡ŒåŠ¨ â”‚         â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                      â”‚               â”‚
â”‚                                      â–¼               â”‚
â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚                              â”‚ éœ€è¦ä½¿ç”¨å·¥å…·ï¼Ÿ â”‚       â”‚
â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                 â”‚       â”‚            â”‚
â”‚                              æ˜¯ â”‚       â”‚ å¦         â”‚
â”‚                                 â–¼       â–¼            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚ æ£€æŸ¥ç»“æœ â”‚ â† â”‚ æ‰§è¡Œå·¥å…· â”‚â†â”€â”€â”˜   â”‚ ç›´æ¥å›å¤ â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚        â”‚                                â”‚            â”‚
â”‚        â–¼                                â”‚            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚            â”‚
â”‚  â”‚ ä»»åŠ¡å®Œæˆï¼Ÿ â”‚                          â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚            â”‚
â”‚     â”‚      â”‚                            â”‚            â”‚
â”‚  å¦ â”‚      â”‚ æ˜¯                         â”‚            â”‚
â”‚     â”‚      â–¼                            â–¼            â”‚
â”‚     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚     â”‚  â”‚ è¿”å›ç»“æœ â”‚              â”‚ è¿”å›ç»“æœ â”‚         â”‚
â”‚     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚     â”‚                                               â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ ç»§ç»­å¾ªç¯ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚
â”‚                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®é™…ä¾‹å­**ï¼šè®©Agent"åˆ›å»ºä¸€ä¸ªPythonè®¡ç®—å™¨"

```
è½®æ¬¡1ï¼š
  - Agentæ€è€ƒï¼šéœ€è¦åˆ›å»ºæ–‡ä»¶
  - ä½¿ç”¨å·¥å…·ï¼šWriteå†™å…¥calculator.py
  - ç»“æœï¼šæ–‡ä»¶åˆ›å»ºæˆåŠŸ
  - åˆ¤æ–­ï¼šä»»åŠ¡æœªå®Œæˆï¼Œéœ€è¦æµ‹è¯•

è½®æ¬¡2ï¼š
  - Agentæ€è€ƒï¼šéœ€è¦éªŒè¯ä»£ç æ˜¯å¦æ­£ç¡®
  - ä½¿ç”¨å·¥å…·ï¼šBashæ‰§è¡Œpython calculator.py
  - ç»“æœï¼šè¿è¡ŒæˆåŠŸ
  - åˆ¤æ–­ï¼šä»»åŠ¡å®Œæˆ

è½®æ¬¡3ï¼š
  - Agentå›å¤ï¼šå·²æˆåŠŸåˆ›å»ºè®¡ç®—å™¨ï¼Œä»£ç å¦‚ä¸‹...
```

**æ§åˆ¶Agent Loopçš„å‚æ•°**ï¼š

```python
options = ClaudeAgentOptions(
    max_turns=10,  # æœ€å¤š10è½®ï¼Œé˜²æ­¢æ— é™å¾ªç¯
    # å¦‚æœä»»åŠ¡ç®€å•ï¼Œå¯ä»¥è®¾å°ä¸€ç‚¹èŠ‚çœtoken
)
```

### 3.3 Toolsï¼šAgentçš„èƒ½åŠ›æ¥æº

Toolsï¼ˆå·¥å…·ï¼‰æ˜¯Agentèƒ½å¤Ÿ"åšäº‹"çš„å…³é”®ã€‚æ²¡æœ‰å·¥å…·ï¼ŒAgentåªèƒ½"è¯´è¯"ä¸èƒ½"å¹²æ´»"ã€‚

**å†…ç½®å·¥å…·æ¸…å•**ï¼š

| å·¥å…·å | åŠŸèƒ½ | ä½¿ç”¨åœºæ™¯ |
|--------|------|---------|
| **Read** | è¯»å–æ–‡ä»¶å†…å®¹ | åˆ†æä»£ç ã€è¯»å–é…ç½® |
| **Write** | å†™å…¥æ–‡ä»¶å†…å®¹ | åˆ›å»ºæ–°æ–‡ä»¶ |
| **Edit** | ç¼–è¾‘æ–‡ä»¶ | ä¿®æ”¹ç°æœ‰ä»£ç  |
| **Bash** | æ‰§è¡Œå‘½ä»¤ | è¿è¡Œè„šæœ¬ã€å®‰è£…ä¾èµ– |
| **Glob** | æ–‡ä»¶æ¨¡å¼åŒ¹é… | æŸ¥æ‰¾ç‰¹å®šç±»å‹çš„æ–‡ä»¶ |
| **Grep** | æœç´¢æ–‡ä»¶å†…å®¹ | åœ¨ä»£ç ä¸­æŸ¥æ‰¾å…³é”®è¯ |
| **Task** | åˆ›å»ºå­ä»£ç† | å¹¶è¡Œå¤„ç†å¤æ‚ä»»åŠ¡ |
| **WebSearch** | ç½‘ç»œæœç´¢ | æŸ¥æ‰¾æœ€æ–°ä¿¡æ¯ |

**é™åˆ¶å·¥å…·æƒé™**ï¼š

```python
# åªå…è®¸è¯»å–å’Œæœç´¢ï¼Œç¦æ­¢ä¿®æ”¹
options = ClaudeAgentOptions(
    allowed_tools=['Read', 'Glob', 'Grep'],  # åªè¯»æƒé™
)

# å…è®¸æ‰€æœ‰å·¥å…·ï¼ˆé»˜è®¤ï¼‰
options = ClaudeAgentOptions(
    allowed_tools=None,  # æˆ–è€…ä¸è®¾ç½®è¿™ä¸ªå‚æ•°
)
```

**è‡ªå®šä¹‰å·¥å…·ï¼ˆSDK MCP Serverï¼‰**ï¼š

è¿™æ˜¯Agent SDKçš„å¼ºå¤§åŠŸèƒ½ä¹‹ä¸€ï¼ä½ å¯ä»¥åˆ›å»ºè‡ªå·±çš„å·¥å…·ï¼š

```python
from claude_agent_sdk import tool, create_sdk_mcp_server, ClaudeAgentOptions, ClaudeSDKClient

# ä½¿ç”¨@toolè£…é¥°å™¨å®šä¹‰å·¥å…·
@tool("greet", "å‘ç”¨æˆ·é—®å¥½", {"name": str})
async def greet_user(args):
    name = args.get('name', 'æœ‹å‹')
    return {
        "content": [
            {"type": "text", "text": f"ä½ å¥½ï¼Œ{name}ï¼å¾ˆé«˜å…´è®¤è¯†ä½ ï¼"}
        ]
    }

@tool("calculate", "æ‰§è¡Œæ•°å­¦è®¡ç®—", {"expression": str})
async def calculate(args):
    expression = args.get('expression', '0')
    try:
        result = eval(expression)  # æ³¨æ„ï¼šç”Ÿäº§ç¯å¢ƒè¦åšå®‰å…¨æ£€æŸ¥ï¼
        return {"content": [{"type": "text", "text": f"è®¡ç®—ç»“æœï¼š{result}"}]}
    except Exception as e:
        return {"content": [{"type": "text", "text": f"è®¡ç®—é”™è¯¯ï¼š{str(e)}"}]}

# åˆ›å»ºSDK MCPæœåŠ¡å™¨
my_tools = create_sdk_mcp_server(
    name="my-tools",
    version="1.0.0",
    tools=[greet_user, calculate]
)

# åœ¨Agentä¸­ä½¿ç”¨
options = ClaudeAgentOptions(
    mcp_servers={"tools": my_tools},
    allowed_tools=["mcp__tools__greet", "mcp__tools__calculate"]
)
```

### 3.4 Subagentsï¼šå­ä»£ç†å¹¶è¡Œå¤„ç†

å½“ä»»åŠ¡å¤ªå¤æ‚æˆ–å¤ªå¤§æ—¶ï¼Œå•ä¸ªAgentå¯èƒ½ä¼šé‡åˆ°ä¸Šä¸‹æ–‡çª—å£é™åˆ¶ã€‚Subagentsï¼ˆå­ä»£ç†ï¼‰è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚

**ç±»æ¯”ç†è§£**ï¼š

```
ä¼ ç»Ÿæ–¹å¼ï¼ˆä¸€ä¸ªäººå¹²æ‰€æœ‰æ´»ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å•ä¸ªAgenté¡ºåºå¤„ç†                           â”‚
â”‚                                            â”‚
â”‚  å¤„ç†api/* â†’ å¤„ç†models/* â†’ å¤„ç†views/*    â”‚
â”‚      2å°æ—¶       2å°æ—¶         2å°æ—¶        â”‚
â”‚                                            â”‚
â”‚  æ€»è€—æ—¶ï¼š6å°æ—¶                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Subagentsæ–¹å¼ï¼ˆä¸»ç®¡+å¤šå‘˜å·¥ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¸»Agentåˆ†é…ä»»åŠ¡ï¼Œå­Agentå¹¶è¡Œæ‰§è¡Œ             â”‚
â”‚                                            â”‚
â”‚  å­Agent1: api/*     â”€â”€â”                   â”‚
â”‚  å­Agent2: models/*  â”€â”€â”¼â”€â”€â†’ æ±‡æ€»ç»“æœ        â”‚
â”‚  å­Agent3: views/*   â”€â”€â”˜                   â”‚
â”‚      å„2å°æ—¶ï¼ˆåŒæ—¶è¿›è¡Œï¼‰                     â”‚
â”‚                                            â”‚
â”‚  æ€»è€—æ—¶ï¼šçº¦2.5å°æ—¶                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒä¼˜åŠ¿**ï¼š

| ä¼˜åŠ¿ | è¯´æ˜ |
|------|------|
| **ç‹¬ç«‹ä¸Šä¸‹æ–‡** | æ¯ä¸ªå­ä»£ç†æœ‰ç‹¬ç«‹çš„200Kä¸Šä¸‹æ–‡çª—å£ |
| **å¹¶è¡Œæ‰§è¡Œ** | æœ€å¤š10ä¸ªå­ä»£ç†åŒæ—¶è¿è¡Œ |
| **ä¸“ä¸šåŒ–åˆ†å·¥** | æ¯ä¸ªå­ä»£ç†å¯ä»¥æœ‰ç‹¬ç«‹çš„ç³»ç»Ÿæç¤ºè¯ |
| **å¤±è´¥éš”ç¦»** | å•ä¸ªå­ä»£ç†å¤±è´¥ä¸å½±å“å…¶ä»–å­ä»£ç† |

**ä½¿ç”¨Subagentsçš„æ–¹å¼**ï¼š

```python
# å…è®¸Taskå·¥å…·ï¼ŒAgentä¼šè‡ªåŠ¨åˆ›å»ºå­ä»£ç†
options = ClaudeAgentOptions(
    allowed_tools=['Task', 'TaskOutput', 'Read', 'Write', 'Edit'],
    max_turns=50,
    system_prompt="""ä½ æ˜¯ä¸€ä¸ªé¡¹ç›®é‡æ„ä¸“å®¶ã€‚
    å½“é‡åˆ°å¤§å‹ä»»åŠ¡æ—¶ï¼Œè¯·ä½¿ç”¨Taskå·¥å…·åˆ›å»ºå­ä»£ç†æ¥å¹¶è¡Œå¤„ç†ã€‚
    æ¯ä¸ªå­ä»£ç†åº”è¯¥ä¸“æ³¨äºä¸€ä¸ªç‹¬ç«‹çš„æ¨¡å—æˆ–ç›®å½•ã€‚"""
)

prompt = """è¯·é‡æ„ä»¥ä¸‹ç›®å½•çš„ä»£ç ï¼š
1. src/api/ - å°†CommonJSæ”¹ä¸ºES Module
2. src/models/ - æ·»åŠ TypeScriptç±»å‹
3. src/views/ - ä¼˜åŒ–ç»„ä»¶ç»“æ„

è¯·ä½¿ç”¨å­ä»£ç†å¹¶è¡Œå¤„ç†è¿™ä¸‰ä¸ªç›®å½•ã€‚"""

async for message in query(prompt=prompt, options=options):
    # å¤„ç†æ¶ˆæ¯...
```

### 3.5 Task å·¥å…·ä¸å­ä»£ç†ç¼–æ’ï¼ˆCLI å†…ç½®ï¼‰

> **è¡¥å……è¯´æ˜**ï¼šä¸Šé¢ 3.4 èŠ‚è®²çš„æ˜¯ SDK ä¸­å¦‚ä½•ç¼–ç¨‹åˆ›å»ºå­ä»£ç†ã€‚è¿™é‡Œä»‹ç» Claude Code CLI ä¸­**å†…ç½®çš„ Task å·¥å…·**â€”â€”ä½ åœ¨äº¤äº’æ¨¡å¼ä¸‹å°±èƒ½ç›´æ¥ä½¿ç”¨çš„å¤š Agent ç¼–æ’ç³»ç»Ÿã€‚

Claude Code CLI å†…ç½®äº†å¼ºå¤§çš„ **Task å·¥å…·**ï¼Œæ— éœ€å†™ä»£ç å°±èƒ½è®© Claude è‡ªåŠ¨åˆ›å»ºå­ä»£ç†ï¼š

**æ ¸å¿ƒå‚æ•°**ï¼š

| å‚æ•° | è¯´æ˜ |
|------|------|
| `subagent_type` | å­ä»£ç†ç±»å‹ï¼ˆExploreã€Bashã€code-reviewer ç­‰ï¼‰ |
| `prompt` | åˆ†é…ç»™å­ä»£ç†çš„ä»»åŠ¡æè¿° |
| `isolation` | è®¾ä¸º `"worktree"` å¯åœ¨ç‹¬ç«‹å·¥ä½œæ ‘ä¸­è¿è¡Œ |
| `run_in_background` | è®¾ä¸º `true` åœ¨åå°è¿è¡Œ |
| `resume` | ä¼ å…¥ä¹‹å‰çš„ agent ID å¯æ¢å¤ä¸­æ–­çš„å­ä»£ç† |
| `model` | å¯æŒ‡å®š sonnet/opus/haikuï¼Œä¸æŒ‡å®šåˆ™ç»§æ‰¿çˆ¶çº§ |

**å¸¸ç”¨å­ä»£ç†ç±»å‹**ï¼š

| ç±»å‹ | ç”¨é€” | å¯ç”¨å·¥å…· |
|------|------|----------|
| `Explore` | å¿«é€Ÿæœç´¢ä»£ç åº“ï¼ˆHaiku é©±åŠ¨ï¼Œé€Ÿåº¦æœ€å¿«ï¼‰ | Readã€Grepã€Glob |
| `Bash` | æ‰§è¡Œç»ˆç«¯å‘½ä»¤ã€git æ“ä½œ | Bash |
| `code-reviewer` | ä»£ç å®¡æŸ¥ | Readã€Grepã€Globã€Bash |
| `general-purpose` | é€šç”¨å¤šæ­¥éª¤ä»»åŠ¡ | å…¨éƒ¨å·¥å…· |
| `Plan` | è®¾è®¡å®ç°æ–¹æ¡ˆ | å…¨éƒ¨ï¼ˆä¸å«å†™å…¥ï¼‰ |

**ä»»åŠ¡ä¾èµ–ï¼ˆDAG ç³»ç»Ÿï¼‰**ï¼š

Task å·¥å…·æ”¯æŒæœ‰å‘æ— ç¯å›¾ï¼ˆDAGï¼‰ä¾èµ–å…³ç³»â€”â€”ä»»åŠ¡ C å¯ä»¥ç­‰å¾…ä»»åŠ¡ A å’Œä»»åŠ¡ B å®Œæˆåå†æ‰§è¡Œï¼š

```
ä»»åŠ¡A: æ„å»ºAPI   â”€â”€â”
                    â”œâ”€â”€â†’ ä»»åŠ¡C: è¿è¡Œé›†æˆæµ‹è¯•
ä»»åŠ¡B: é…ç½®è®¤è¯  â”€â”€â”˜
```

**å­ä»£ç†ä¸Šä¸‹æ–‡æ³¨å…¥**ï¼š

å­ä»£ç†è·å–ä¸Šä¸‹æ–‡çš„ä¸‰ç§æ–¹å¼ï¼š

1. **Skills æ³¨å…¥**ï¼šåœ¨å®šä¹‰ä¸­æŒ‡å®š skills å­—æ®µï¼Œå®Œæ•´æŠ€èƒ½å†…å®¹ç›´æ¥æ³¨å…¥å­ä»£ç†
2. **Memory æŒä¹…åŒ–**ï¼šå­ä»£ç†å¯æ‹¥æœ‰æŒä¹…è®°å¿†ç›®å½•ï¼Œè·¨ä¼šè¯ç§¯ç´¯çŸ¥è¯†
3. **å·¥å…·è®¿é—®æ§åˆ¶**ï¼šé€šè¿‡ `allowedTools` / `disallowedTools` ç²¾ç»†æ§åˆ¶å­ä»£ç†èƒ½åŠ›

> ğŸ’¡ **æç¤º**ï¼šå­ä»£ç†ä¸èƒ½å†åˆ›å»ºå­ä»£ç†ï¼ˆåªæœ‰ä¸€å±‚åµŒå¥—ï¼‰ï¼Œæœ€å¤šå¯åŒæ—¶è¿è¡Œ 10 ä¸ªå¹¶è¡Œå­ä»£ç†ã€‚

---

## ç¬¬å››éƒ¨åˆ†ï¼šå®æˆ˜é¡¹ç›®

### é¡¹ç›®1ï¼šä»£ç åˆ†æAgentï¼ˆOne-shotæ¨¡å¼ï¼‰

**ç›®æ ‡**ï¼šåˆ›å»ºä¸€ä¸ªèƒ½åˆ†æä»£ç æ–‡ä»¶å¹¶ç»™å‡ºæ”¹è¿›å»ºè®®çš„Agent

**éš¾åº¦**ï¼šâ­ å…¥é—¨

**Pythonå®ç°** - `code_analyzer.py`ï¼š

```python
"""
ä»£ç åˆ†æAgent - åˆ†ææŒ‡å®šæ–‡ä»¶çš„ä»£ç è´¨é‡
"""
import asyncio
import sys
from pathlib import Path
from claude_agent_sdk import query, ClaudeAgentOptions, AssistantMessage, TextBlock

async def analyze_code(file_path: str) -> None:
    """åˆ†ææŒ‡å®šæ–‡ä»¶çš„ä»£ç è´¨é‡"""

    # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
    path = Path(file_path)
    if not path.exists():
        print(f"é”™è¯¯ï¼šæ–‡ä»¶ {file_path} ä¸å­˜åœ¨")
        return

    print(f"åˆ†ææ–‡ä»¶: {path.absolute()}")
    print("=" * 50)

    # é…ç½®Agent
    options = ClaudeAgentOptions(
        model='claude-sonnet-4-5-20250929',
        cwd=str(Path.cwd()),
        allowed_tools=['Read', 'Glob', 'Grep'],  # åªç»™è¯»å–æƒé™
        max_turns=5,
        system_prompt="""ä½ æ˜¯ä¸€ä½èµ„æ·±ä»£ç å®¡æŸ¥ä¸“å®¶ã€‚
        è¯·åˆ†æä»£ç å¹¶æä¾›ï¼š
        1. ä»£ç æ¦‚è¿°ï¼ˆåŠŸèƒ½å’Œç»“æ„ï¼‰
        2. æ½œåœ¨é—®é¢˜ï¼ˆbugé£é™©ã€å®‰å…¨éšæ‚£ï¼‰
        3. æ”¹è¿›å»ºè®®ï¼ˆå¯è¯»æ€§ã€æ€§èƒ½ã€æœ€ä½³å®è·µï¼‰

        è¯·ä½¿ç”¨ä¸­æ–‡å›å¤ï¼Œæ ¼å¼æ¸…æ™°ã€‚"""
    )

    prompt = f"""è¯·åˆ†æä»¥ä¸‹æ–‡ä»¶çš„ä»£ç è´¨é‡ï¼š{path.absolute()}

    ä½¿ç”¨Readå·¥å…·è¯»å–æ–‡ä»¶å†…å®¹ï¼Œç„¶åç»™å‡ºè¯¦ç»†åˆ†æã€‚"""

    # æ‰§è¡Œåˆ†æ
    async for message in query(prompt=prompt, options=options):
        if isinstance(message, AssistantMessage):
            for block in message.content:
                if isinstance(block, TextBlock):
                    print(block.text, end='', flush=True)

    print("\n" + "=" * 50)
    print("åˆ†æå®Œæˆï¼")

def main():
    # ä»å‘½ä»¤è¡Œå‚æ•°è·å–æ–‡ä»¶è·¯å¾„
    if len(sys.argv) < 2:
        print("ç”¨æ³•: python code_analyzer.py <æ–‡ä»¶è·¯å¾„>")
        print("ç¤ºä¾‹: python code_analyzer.py ./my_code.py")
        return

    file_path = sys.argv[1]
    asyncio.run(analyze_code(file_path))

if __name__ == '__main__':
    main()
```

**ä½¿ç”¨æ–¹æ³•**ï¼š

```bash
# åˆ†æPythonæ–‡ä»¶
python code_analyzer.py ./my_script.py

# åˆ†æJavaScriptæ–‡ä»¶
python code_analyzer.py ./app.js
```

---

### é¡¹ç›®2ï¼šå¤šå·¥å…·Agentï¼ˆMulti-toolæ¨¡å¼ï¼‰

**ç›®æ ‡**ï¼šåˆ›å»ºä¸€ä¸ªèƒ½è¯»å†™æ–‡ä»¶ã€æ‰§è¡Œå‘½ä»¤çš„å…¨èƒ½Agent

**éš¾åº¦**ï¼šâ­â­ è¿›é˜¶

**Pythonå®ç°** - `multi_tool_agent.py`ï¼š

```python
"""
å¤šå·¥å…·Agent - å¯ä»¥è¯»å†™æ–‡ä»¶ã€æ‰§è¡Œå‘½ä»¤çš„å…¨èƒ½åŠ©æ‰‹
"""
import asyncio
from pathlib import Path
from claude_agent_sdk import (
    query,
    ClaudeAgentOptions,
    AssistantMessage,
    TextBlock,
    ToolUseBlock,
    ToolResultBlock
)

async def run_multi_tool_agent(task: str) -> None:
    """è¿è¡Œå¤šå·¥å…·Agentæ‰§è¡Œä»»åŠ¡"""

    print(f"ä»»åŠ¡: {task}")
    print("=" * 60)

    options = ClaudeAgentOptions(
        model='claude-sonnet-4-5-20250929',  # Sonnet 4.5
        cwd=str(Path.cwd()),
        allowed_tools=['Read', 'Write', 'Edit', 'Bash', 'Glob', 'Grep'],
        max_turns=15,
        permission_mode='acceptEdits',  # è‡ªåŠ¨æ¥å—æ–‡ä»¶ç¼–è¾‘
        system_prompt="""ä½ æ˜¯ä¸€ä¸ªå…¨èƒ½å¼€å‘åŠ©æ‰‹ï¼Œå¯ä»¥ï¼š
        - è¯»å–å’Œåˆ†ææ–‡ä»¶
        - åˆ›å»ºå’Œä¿®æ”¹æ–‡ä»¶
        - æ‰§è¡Œå‘½ä»¤è¡Œå‘½ä»¤
        - æœç´¢æ–‡ä»¶å†…å®¹

        æ‰§è¡Œä»»åŠ¡æ—¶ï¼š
        1. å…ˆåˆ†æéœ€è¦åšä»€ä¹ˆ
        2. åˆ†æ­¥éª¤æ‰§è¡Œ
        3. æ¯æ­¥éƒ½éªŒè¯ç»“æœ
        4. æœ€åæ€»ç»“å®Œæˆæƒ…å†µ

        ä½¿ç”¨ä¸­æ–‡å›å¤ã€‚"""
    )

    # æ‰§è¡Œä»»åŠ¡
    async for message in query(prompt=task, options=options):
        if isinstance(message, AssistantMessage):
            for block in message.content:
                if isinstance(block, TextBlock):
                    print(block.text, end='', flush=True)
                elif isinstance(block, ToolUseBlock):
                    print(f"\n[ä½¿ç”¨å·¥å…·: {block.name}]")

        elif isinstance(message, ToolResultBlock):
            print(f"[å·¥å…·æ‰§è¡Œå®Œæˆ]\n")

    print("\n" + "=" * 60)
    print("ä»»åŠ¡æ‰§è¡Œå®Œæˆï¼")

async def main():
    # ç¤ºä¾‹ä»»åŠ¡åˆ—è¡¨
    tasks = [
        "åˆ›å»ºä¸€ä¸ªåä¸ºhello.pyçš„æ–‡ä»¶ï¼Œå†…å®¹æ˜¯æ‰“å°'Hello, Agent SDK!'ï¼Œç„¶åè¿è¡Œå®ƒ",
        "æŸ¥æ‰¾å½“å‰ç›®å½•ä¸‹æ‰€æœ‰çš„.pyæ–‡ä»¶ï¼Œåˆ—å‡ºå®ƒä»¬çš„åç§°",
        "åˆ›å»ºä¸€ä¸ªç®€å•çš„README.mdæ–‡ä»¶ï¼Œæè¿°è¿™æ˜¯ä¸€ä¸ªAgent SDKæ¼”ç¤ºé¡¹ç›®",
    ]

    print("å¯ç”¨ä»»åŠ¡:")
    for i, task in enumerate(tasks, 1):
        print(f"  {i}. {task}")
    print()

    # é€‰æ‹©ä»»åŠ¡
    choice = input("è¾“å…¥ä»»åŠ¡ç¼–å·ï¼ˆ1-3ï¼‰æˆ–è‡ªå®šä¹‰ä»»åŠ¡: ").strip()

    if choice in ['1', '2', '3']:
        task = tasks[int(choice) - 1]
    else:
        task = choice

    await run_multi_tool_agent(task)

if __name__ == '__main__':
    asyncio.run(main())
```

**è¿è¡Œç¤ºä¾‹**ï¼š

```bash
python multi_tool_agent.py

# è¾“å‡ºï¼š
# å¯ç”¨ä»»åŠ¡:
#   1. åˆ›å»ºä¸€ä¸ªåä¸ºhello.pyçš„æ–‡ä»¶...
#   2. æŸ¥æ‰¾å½“å‰ç›®å½•ä¸‹æ‰€æœ‰çš„.pyæ–‡ä»¶...
#   3. åˆ›å»ºä¸€ä¸ªç®€å•çš„README.mdæ–‡ä»¶...
#
# è¾“å…¥ä»»åŠ¡ç¼–å·ï¼ˆ1-3ï¼‰æˆ–è‡ªå®šä¹‰ä»»åŠ¡: 1
```

---

### é¡¹ç›®3ï¼šæµå¼äº¤äº’Agentï¼ˆStreaming + è‡ªå®šä¹‰å·¥å…·ï¼‰

**ç›®æ ‡**ï¼šåˆ›å»ºä¸€ä¸ªå¸¦æœ‰è‡ªå®šä¹‰å·¥å…·çš„äº¤äº’å¼Agent

**éš¾åº¦**ï¼šâ­â­â­ é«˜çº§

**Pythonå®ç°** - `interactive_agent.py`ï¼š

```python
"""
äº¤äº’å¼Agent - å¸¦æœ‰è‡ªå®šä¹‰å·¥å…·çš„æµå¼å¯¹è¯Agent
"""
import asyncio
from datetime import datetime
from claude_agent_sdk import (
    tool,
    create_sdk_mcp_server,
    ClaudeAgentOptions,
    ClaudeSDKClient,
    AssistantMessage,
    TextBlock,
    ToolUseBlock
)

# ============ è‡ªå®šä¹‰å·¥å…·å®šä¹‰ ============

@tool("get_time", "è·å–å½“å‰æ—¶é—´", {})
async def get_current_time(args):
    """è¿”å›å½“å‰æ—¶é—´"""
    now = datetime.now()
    return {
        "content": [{
            "type": "text",
            "text": f"å½“å‰æ—¶é—´ï¼š{now.strftime('%Y-%m-%d %H:%M:%S')}"
        }]
    }

@tool("calculate", "æ‰§è¡Œæ•°å­¦è®¡ç®—", {
    "expression": {"type": "string", "description": "æ•°å­¦è¡¨è¾¾å¼ï¼Œå¦‚ 2+2, 10*5"}
})
async def calculate(args):
    """æ‰§è¡Œæ•°å­¦è®¡ç®—"""
    expression = args.get('expression', '0')
    try:
        # å®‰å…¨çš„æ•°å­¦è®¡ç®—ï¼ˆåªå…è®¸åŸºæœ¬è¿ç®—ï¼‰
        allowed_chars = set('0123456789+-*/().% ')
        if not all(c in allowed_chars for c in expression):
            return {"content": [{"type": "text", "text": "é”™è¯¯ï¼šè¡¨è¾¾å¼åŒ…å«ä¸å…è®¸çš„å­—ç¬¦"}]}

        result = eval(expression)
        return {"content": [{"type": "text", "text": f"{expression} = {result}"}]}
    except Exception as e:
        return {"content": [{"type": "text", "text": f"è®¡ç®—é”™è¯¯ï¼š{str(e)}"}]}

@tool("todo_add", "æ·»åŠ å¾…åŠäº‹é¡¹", {
    "item": {"type": "string", "description": "å¾…åŠäº‹é¡¹å†…å®¹"}
})
async def add_todo(args):
    """æ·»åŠ å¾…åŠäº‹é¡¹"""
    item = args.get('item', '')
    if not item:
        return {"content": [{"type": "text", "text": "é”™è¯¯ï¼šå¾…åŠäº‹é¡¹ä¸èƒ½ä¸ºç©º"}]}

    # è¿™é‡Œå¯ä»¥è¿æ¥æ•°æ®åº“ï¼Œç®€åŒ–èµ·è§ç”¨æ–‡ä»¶å­˜å‚¨
    with open('todos.txt', 'a', encoding='utf-8') as f:
        f.write(f"[ ] {item}\n")

    return {"content": [{"type": "text", "text": f"å·²æ·»åŠ å¾…åŠäº‹é¡¹ï¼š{item}"}]}

@tool("todo_list", "åˆ—å‡ºæ‰€æœ‰å¾…åŠäº‹é¡¹", {})
async def list_todos(args):
    """åˆ—å‡ºå¾…åŠäº‹é¡¹"""
    try:
        with open('todos.txt', 'r', encoding='utf-8') as f:
            todos = f.read().strip()

        if not todos:
            return {"content": [{"type": "text", "text": "å¾…åŠäº‹é¡¹åˆ—è¡¨ä¸ºç©º"}]}

        return {"content": [{"type": "text", "text": f"å¾…åŠäº‹é¡¹åˆ—è¡¨ï¼š\n{todos}"}]}
    except FileNotFoundError:
        return {"content": [{"type": "text", "text": "å¾…åŠäº‹é¡¹åˆ—è¡¨ä¸ºç©º"}]}

# ============ Agenté…ç½® ============

# åˆ›å»ºè‡ªå®šä¹‰å·¥å…·æœåŠ¡å™¨
custom_tools = create_sdk_mcp_server(
    name="custom-tools",
    version="1.0.0",
    tools=[get_current_time, calculate, add_todo, list_todos]
)

# Agenté…ç½®
def get_options():
    return ClaudeAgentOptions(
        model='claude-sonnet-4-5-20250929',  # Sonnet 4.5(æ¨è)
        mcp_servers={"custom": custom_tools},
        allowed_tools=[
            "Read", "Write", "Bash",
            "mcp__custom__get_time",
            "mcp__custom__calculate",
            "mcp__custom__todo_add",
            "mcp__custom__todo_list"
        ],
        permission_mode='acceptEdits',
        system_prompt="""ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½åŠ©æ‰‹ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å·¥å…·ï¼š

1. **get_time**: è·å–å½“å‰æ—¶é—´
2. **calculate**: æ‰§è¡Œæ•°å­¦è®¡ç®—
3. **todo_add**: æ·»åŠ å¾…åŠäº‹é¡¹
4. **todo_list**: åˆ—å‡ºæ‰€æœ‰å¾…åŠäº‹é¡¹
5. **Read/Write/Bash**: æ–‡ä»¶æ“ä½œå’Œå‘½ä»¤æ‰§è¡Œ

è¯·æ ¹æ®ç”¨æˆ·éœ€æ±‚é€‰æ‹©åˆé€‚çš„å·¥å…·ã€‚ä½¿ç”¨ä¸­æ–‡å›å¤ã€‚
å½“ç”¨æˆ·è¯´"é€€å‡º"æˆ–"å†è§"æ—¶ï¼Œå‹å¥½åœ°å‘Šåˆ«ã€‚"""
    )

# ============ äº¤äº’å¾ªç¯ ============

async def interactive_chat():
    """äº¤äº’å¼å¯¹è¯å¾ªç¯"""
    print("=" * 60)
    print("æ¬¢è¿ä½¿ç”¨äº¤äº’å¼Agentï¼")
    print("ä½ å¯ä»¥ï¼š")
    print("  - é—®æˆ‘ç°åœ¨å‡ ç‚¹äº†")
    print("  - è®©æˆ‘è®¡ç®—æ•°å­¦é¢˜ï¼ˆå¦‚ï¼šè®¡ç®— 123 * 456ï¼‰")
    print("  - æ·»åŠ å¾…åŠäº‹é¡¹ï¼ˆå¦‚ï¼šæ·»åŠ å¾…åŠ å†™å‘¨æŠ¥ï¼‰")
    print("  - æŸ¥çœ‹å¾…åŠäº‹é¡¹åˆ—è¡¨")
    print("  - è®©æˆ‘è¯»å†™æ–‡ä»¶æˆ–æ‰§è¡Œå‘½ä»¤")
    print("è¾“å…¥ 'é€€å‡º' æˆ– 'å†è§' ç»“æŸå¯¹è¯")
    print("=" * 60)
    print()

    async with ClaudeSDKClient(options=get_options()) as client:
        while True:
            # è·å–ç”¨æˆ·è¾“å…¥
            try:
                user_input = input("ä½ : ").strip()
            except EOFError:
                break

            if not user_input:
                continue

            # æ£€æŸ¥é€€å‡º
            if user_input.lower() in ['é€€å‡º', 'å†è§', 'exit', 'quit', 'bye']:
                print("\nAgent: å†è§ï¼ç¥ä½ æœ‰æ„‰å¿«çš„ä¸€å¤©ï¼")
                break

            # å‘é€æ¶ˆæ¯
            await client.query(user_input)

            # å¤„ç†å“åº”
            print("Agent: ", end='', flush=True)
            async for message in client.receive_response():
                if isinstance(message, AssistantMessage):
                    for block in message.content:
                        if isinstance(block, TextBlock):
                            print(block.text, end='', flush=True)
                        elif isinstance(block, ToolUseBlock):
                            print(f"\n[è°ƒç”¨å·¥å…·: {block.name}]", end='', flush=True)

            print()  # æ¢è¡Œ

async def main():
    await interactive_chat()

if __name__ == '__main__':
    asyncio.run(main())
```

**è¿è¡Œç¤ºä¾‹**ï¼š

```bash
python interactive_agent.py

# äº¤äº’ç¤ºä¾‹ï¼š
# ============================================================
# æ¬¢è¿ä½¿ç”¨äº¤äº’å¼Agentï¼
# ...
# ============================================================
#
# ä½ : ç°åœ¨å‡ ç‚¹äº†ï¼Ÿ
# Agent: [è°ƒç”¨å·¥å…·: get_time]
# å½“å‰æ—¶é—´æ˜¯ 2025-12-19 15:30:45
#
# ä½ : è®¡ç®— 123 * 456
# Agent: [è°ƒç”¨å·¥å…·: calculate]
# 123 * 456 = 56088
#
# ä½ : æ·»åŠ å¾…åŠ å†™Agent SDKæ•™ç¨‹
# Agent: [è°ƒç”¨å·¥å…·: todo_add]
# å·²æ·»åŠ å¾…åŠäº‹é¡¹ï¼šå†™Agent SDKæ•™ç¨‹
#
# ä½ : é€€å‡º
# Agent: å†è§ï¼ç¥ä½ æœ‰æ„‰å¿«çš„ä¸€å¤©ï¼
```

---

## ç¬¬äº”éƒ¨åˆ†ï¼šé«˜çº§åŠŸèƒ½

### 5.1 MCPæœåŠ¡å™¨é›†æˆ

MCPï¼ˆModel Context Protocolï¼‰è®©ä½ å¯ä»¥è¿æ¥å¤–éƒ¨å·¥å…·å’ŒæœåŠ¡ã€‚

**å¤–éƒ¨MCPæœåŠ¡å™¨é…ç½®**ï¼š

```python
from claude_agent_sdk import query, ClaudeAgentOptions

options = ClaudeAgentOptions(
    mcp_servers={
        # æ–‡ä»¶ç³»ç»ŸæœåŠ¡å™¨
        "filesystem": {
            "command": "npx",
            "args": ["-y", "@anthropic/mcp-server-filesystem", "/allowed/path"]
        },

        # SQLiteæ•°æ®åº“æœåŠ¡å™¨
        "database": {
            "command": "npx",
            "args": ["-y", "@anthropic/mcp-server-sqlite", "./data/app.db"]
        },

        # è‡ªå®šä¹‰PythonæœåŠ¡å™¨
        "custom": {
            "command": "python",
            "args": ["-m", "my_mcp_server"],
            "env": {
                "API_KEY": "your-api-key"
            }
        }
    },
    allowed_tools=[
        "mcp__filesystem__read",
        "mcp__database__query",
        "mcp__custom__my_tool"
    ]
)
```

**SDKå†…ç½®MCPæœåŠ¡å™¨ vs å¤–éƒ¨æœåŠ¡å™¨**ï¼š

| ç‰¹æ€§ | SDKå†…ç½®æœåŠ¡å™¨ | å¤–éƒ¨æœåŠ¡å™¨ |
|------|--------------|-----------|
| **è¿è¡Œæ–¹å¼** | åœ¨ä½ çš„Pythonè¿›ç¨‹å†… | ç‹¬ç«‹å­è¿›ç¨‹ |
| **æ€§èƒ½** | æ›´å¿«ï¼ˆæ— IPCå¼€é”€ï¼‰ | ç•¥æ…¢ï¼ˆéœ€è¦è¿›ç¨‹é€šä¿¡ï¼‰ |
| **éƒ¨ç½²** | ç®€å•ï¼ˆå•è¿›ç¨‹ï¼‰ | éœ€è¦ç®¡ç†å¤šè¿›ç¨‹ |
| **è°ƒè¯•** | æ›´å®¹æ˜“ | éœ€è¦åˆ†åˆ«è°ƒè¯• |
| **é€‚ç”¨åœºæ™¯** | ç®€å•å·¥å…· | å¤æ‚å·¥å…·ã€ç°æœ‰MCPæœåŠ¡å™¨ |

### 5.2 Hooksï¼šåœ¨å…³é”®æ—¶åˆ»è‡ªåŠ¨æ‰§è¡Œ

Hooksï¼ˆé’©å­ï¼‰è®©ä½ å¯ä»¥åœ¨Agentæ‰§è¡Œçš„ç‰¹å®šæ—¶æœºæ’å…¥è‡ªå®šä¹‰é€»è¾‘ã€‚

**å¯ç”¨çš„Hookç±»å‹**ï¼š

| Hookç±»å‹ | è§¦å‘æ—¶æœº | ç”¨é€” |
|----------|---------|------|
| **PreToolUse** | å·¥å…·æ‰§è¡Œå‰ | éªŒè¯ã€è¿‡æ»¤å±é™©å‘½ä»¤ |
| **PostToolUse** | å·¥å…·æ‰§è¡Œå | è®°å½•æ—¥å¿—ã€è‡ªåŠ¨æµ‹è¯• |
| **Stop** | Agentåœæ­¢æ—¶ | æ¸…ç†ã€æ±‡æ€»æŠ¥å‘Š |
| **UserPromptSubmit** | ç”¨æˆ·æäº¤æç¤ºæ—¶ | å¤„ç†å’Œå¢å¼ºç”¨æˆ·è¾“å…¥ |
| **SessionStart** | ä¼šè¯å¼€å§‹æ—¶ | åŠ è½½ä¸Šæ¬¡ä¼šè¯çŠ¶æ€ |
| **SessionEnd** | ä¼šè¯ç»“æŸæ—¶ | ä¿å­˜ä¼šè¯çŠ¶æ€ |
| **PreCompact** | ä¸Šä¸‹æ–‡å‹ç¼©å‰ | ä¿å­˜å…³é”®ä¿¡æ¯ |

**Python Hooksç¤ºä¾‹**ï¼š

```python
from claude_agent_sdk import ClaudeAgentOptions, ClaudeSDKClient, HookMatcher

# å®šä¹‰Hookå‡½æ•°
async def block_dangerous_commands(input_data, tool_use_id, context):
    """é˜»æ­¢å±é™©çš„Bashå‘½ä»¤"""
    tool_name = input_data.get("tool_name")
    tool_input = input_data.get("tool_input", {})

    # åªæ£€æŸ¥Bashå‘½ä»¤
    if tool_name != "Bash":
        return {}

    command = tool_input.get("command", "")

    # å±é™©å‘½ä»¤é»‘åå•
    dangerous_patterns = ["rm -rf", "sudo rm", ":(){ :|:& };:", "dd if="]

    for pattern in dangerous_patterns:
        if pattern in command:
            return {
                "hookSpecificOutput": {
                    "hookEventName": "PreToolUse",
                    "permissionDecision": "deny",
                    "permissionDecisionReason": f"å±é™©å‘½ä»¤è¢«é˜»æ­¢ï¼šåŒ…å« '{pattern}'"
                }
            }

    return {}  # å…è®¸æ‰§è¡Œ

async def log_tool_results(input_data, tool_use_id, context):
    """è®°å½•å·¥å…·æ‰§è¡Œç»“æœ"""
    tool_name = input_data.get("tool_name")
    print(f"[æ—¥å¿—] å·¥å…· {tool_name} æ‰§è¡Œå®Œæˆ")
    return {}

# é…ç½®Hooks
options = ClaudeAgentOptions(
    allowed_tools=["Bash", "Read", "Write"],
    hooks={
        "PreToolUse": [
            HookMatcher(matcher="Bash", hooks=[block_dangerous_commands]),
        ],
        "PostToolUse": [
            HookMatcher(matcher=".*", hooks=[log_tool_results]),
        ],
    }
)
```

### 5.3 æƒé™æ§åˆ¶

Agent SDKæä¾›å¤šç§æƒé™æ§åˆ¶æ–¹å¼ï¼Œç¡®ä¿å®‰å…¨ã€‚

**æƒé™æ¨¡å¼**ï¼š

| æ¨¡å¼ | è¯´æ˜ | é€‚ç”¨åœºæ™¯ |
|------|------|---------|
| `default` | æ¯æ¬¡æ–‡ä»¶æ“ä½œéƒ½éœ€è¦ç¡®è®¤ | ç”Ÿäº§ç¯å¢ƒã€æ•æ„Ÿé¡¹ç›® |
| `acceptEdits` | è‡ªåŠ¨æ¥å—æ–‡ä»¶ç¼–è¾‘ | ä¸ªäººé¡¹ç›®ã€è‡ªåŠ¨åŒ–è„šæœ¬ |
| `bypassPermissions` | è·³è¿‡æ‰€æœ‰æƒé™æ£€æŸ¥ | å®Œå…¨å—æ§ç¯å¢ƒï¼ˆè°¨æ…ä½¿ç”¨ï¼‰ |

**å·¥å…·ç™½åå•**ï¼š

```python
# åªè¯»Agent - åªèƒ½è¯»å–å’Œæœç´¢
readonly_options = ClaudeAgentOptions(
    allowed_tools=['Read', 'Glob', 'Grep']
)

# ä»£ç å®¡æŸ¥Agent - åªèƒ½è¯»å–å’Œæ‰§è¡Œæµ‹è¯•
review_options = ClaudeAgentOptions(
    allowed_tools=['Read', 'Glob', 'Grep', 'Bash'],
    system_prompt="ä½ æ˜¯ä»£ç å®¡æŸ¥ä¸“å®¶ã€‚åªèƒ½è¿è¡Œæµ‹è¯•å‘½ä»¤ï¼Œä¸èƒ½ä¿®æ”¹ä»»ä½•æ–‡ä»¶ã€‚"
)

# å®Œå…¨æƒé™Agent - å¯ä»¥åšä»»ä½•äº‹
full_options = ClaudeAgentOptions(
    allowed_tools=['Read', 'Write', 'Edit', 'Bash', 'Glob', 'Grep', 'Task'],
    permission_mode='acceptEdits'
)
```

### 5.4 æ²™ç®±æ¨¡å¼

ä¿æŠ¤ä½ çš„ç³»ç»Ÿå…å—æ„å¤–æŸå®³ï¼š

```python
from claude_agent_sdk import query, ClaudeAgentOptions

# è‡ªå®šä¹‰æ²™ç®±æ§åˆ¶
async def can_use_tool(tool: str, input: dict) -> bool:
    """è‡ªå®šä¹‰å·¥å…·æƒé™æ£€æŸ¥"""
    # æ£€æŸ¥æ˜¯å¦è¯·æ±‚ç¦ç”¨æ²™ç®±
    if tool == "Bash" and input.get("dangerouslyDisableSandbox"):
        print(f"è­¦å‘Šï¼šè¯·æ±‚åœ¨æ²™ç®±å¤–æ‰§è¡Œå‘½ä»¤ï¼š{input.get('command')}")
        # è¿”å›Falseæ‹’ç»ï¼ŒTrueå…è®¸
        return False
    return True

options = ClaudeAgentOptions(
    sandbox={
        "enabled": True,  # å¯ç”¨æ²™ç®±
        "allowUnsandboxedCommands": False  # ç¦æ­¢è¯·æ±‚æ²™ç®±å¤–æ‰§è¡Œ
    },
    permission_mode="default",
    can_use_tool=can_use_tool  # è‡ªå®šä¹‰æƒé™æ£€æŸ¥
)
```

---

## ç¬¬å…­éƒ¨åˆ†ï¼šæ•…éšœæ’æŸ¥

### 6.1 å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

#### é”™è¯¯1ï¼šæ¨¡å—å¯¼å…¥å¤±è´¥

```python
# é”™è¯¯ä¿¡æ¯
ModuleNotFoundError: No module named 'claude_agent_sdk'
```

**åŸå› **ï¼šSDKæœªå®‰è£…æˆ–è™šæ‹Ÿç¯å¢ƒæœªæ¿€æ´»

**è§£å†³æ–¹æ¡ˆ**ï¼š

```bash
# ç¡®è®¤è™šæ‹Ÿç¯å¢ƒå·²æ¿€æ´»
source venv/bin/activate  # Linux/macOS
# æˆ–
venv\Scripts\activate  # Windows

# é‡æ–°å®‰è£…
pip install claude-agent-sdk

# éªŒè¯å®‰è£…
pip show claude-agent-sdk
```

---

#### é”™è¯¯2ï¼šè®¤è¯å¤±è´¥

```python
# é”™è¯¯ä¿¡æ¯
AuthenticationError: Invalid API key
```

**åŸå› **ï¼šAPI Keyæœªé…ç½®æˆ–æ— æ•ˆ

**è§£å†³æ–¹æ¡ˆ**ï¼š

```bash
# æ£€æŸ¥ç¯å¢ƒå˜é‡
echo $ANTHROPIC_API_KEY  # Linux/macOS
echo %ANTHROPIC_API_KEY%  # Windows

# é‡æ–°è®¾ç½®
export ANTHROPIC_API_KEY="sk-ant-api03-your-key-here"

# æˆ–åœ¨ä»£ç ä¸­è®¾ç½®ï¼ˆä¸æ¨èï¼‰
import os
os.environ["ANTHROPIC_API_KEY"] = "your-key"
```

---

#### é”™è¯¯3ï¼šè¿æ¥è¶…æ—¶

```python
# é”™è¯¯ä¿¡æ¯
ConnectionTimeout: Request timed out
```

**åŸå› **ï¼šç½‘ç»œé—®é¢˜æˆ–APIæœåŠ¡ç¹å¿™

**è§£å†³æ–¹æ¡ˆ**ï¼š

```bash
# æ£€æŸ¥ç½‘ç»œè¿æ¥
ping api.anthropic.com

# å›½å†…ç”¨æˆ·å¯èƒ½éœ€è¦ä»£ç†
export HTTP_PROXY="http://127.0.0.1:7890"
export HTTPS_PROXY="http://127.0.0.1:7890"
```

---

#### é”™è¯¯4ï¼šå·¥å…·æƒé™è¢«æ‹’ç»

```python
# é”™è¯¯ä¿¡æ¯
PermissionDenied: Tool 'Write' is not in allowed_tools
```

**åŸå› **ï¼šå·¥å…·ä¸åœ¨ç™½åå•ä¸­

**è§£å†³æ–¹æ¡ˆ**ï¼š

```python
# æ·»åŠ éœ€è¦çš„å·¥å…·åˆ°ç™½åå•
options = ClaudeAgentOptions(
    allowed_tools=['Read', 'Write', 'Edit']  # æ·»åŠ Write
)
```

---

#### é”™è¯¯5ï¼šCLIæœªæ‰¾åˆ°

```python
# é”™è¯¯ä¿¡æ¯
CLINotFoundError: Claude Code CLI not found
```

**åŸå› **ï¼šæ†ç»‘çš„CLIæœªæ­£ç¡®å®‰è£…

**è§£å†³æ–¹æ¡ˆ**ï¼š

```bash
# æ–¹æ³•1ï¼šé‡æ–°å®‰è£…SDK
pip uninstall claude-agent-sdk
pip install claude-agent-sdk

# æ–¹æ³•2ï¼šæ‰‹åŠ¨å®‰è£…CLI
curl -fsSL https://claude.ai/install.sh | bash

# æ–¹æ³•3ï¼šæŒ‡å®šCLIè·¯å¾„
options = ClaudeAgentOptions(
    cli_path="/path/to/claude"
)
```

### 6.2 è°ƒè¯•æŠ€å·§

**å¯ç”¨è¯¦ç»†æ—¥å¿—**ï¼š

```python
import logging

# è®¾ç½®æ—¥å¿—çº§åˆ«
logging.basicConfig(level=logging.DEBUG)

# æˆ–è€…ä½¿ç”¨ç¯å¢ƒå˜é‡
# export CLAUDE_SDK_LOG_LEVEL=DEBUG
```

**æ‰“å°æ¶ˆæ¯è¯¦æƒ…**ï¼š

```python
async for message in query(prompt="...", options=options):
    print(f"æ¶ˆæ¯ç±»å‹: {type(message).__name__}")
    print(f"æ¶ˆæ¯å†…å®¹: {message}")
    print("-" * 40)
```

---

## ç¬¬ä¸ƒéƒ¨åˆ†ï¼šFAQ å¸¸è§é—®é¢˜

### Q1: Agent SDKå’Œç›´æ¥è°ƒç”¨Claude APIæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**ç­”**ï¼šä¸»è¦åŒºåˆ«æœ‰ä¸‰ç‚¹ï¼š

1. **Agent SDKæœ‰Agent Loop**ï¼šå¯ä»¥è‡ªåŠ¨å¤šè½®å¯¹è¯ï¼Œä½¿ç”¨å·¥å…·å®Œæˆå¤æ‚ä»»åŠ¡
2. **Agent SDKæœ‰å†…ç½®å·¥å…·**ï¼šæ–‡ä»¶æ“ä½œã€å‘½ä»¤æ‰§è¡Œç­‰èƒ½åŠ›å¼€ç®±å³ç”¨
3. **Agent SDKæ”¯æŒå­ä»£ç†**ï¼šå¯ä»¥å¹¶è¡Œå¤„ç†å¤§è§„æ¨¡ä»»åŠ¡

å¦‚æœä½ åªéœ€è¦ç®€å•é—®ç­”ï¼Œç”¨Claude APIå³å¯ã€‚å¦‚æœéœ€è¦AI"å¹²æ´»"ï¼ˆæ“ä½œæ–‡ä»¶ã€æ‰§è¡Œå‘½ä»¤ï¼‰ï¼Œç”¨Agent SDKã€‚

---

### Q2: å“ªä¸ªæ¨¡å‹æ€§ä»·æ¯”æœ€é«˜ï¼Ÿ

**ç­”**ï¼šæ¨èæ¨¡å‹é€‰æ‹©ï¼š

| åœºæ™¯ | æ¨èæ¨¡å‹ | ç†ç”± |
|------|---------|------|
| æ—¥å¸¸å¼€å‘ | claude-sonnet-4-5-20250929 | èƒ½åŠ›å¼ºã€é€Ÿåº¦å¿«ã€ä»·æ ¼é€‚ä¸­ |
| å¤æ‚æ¨ç† | claude-opus-4-5-20251101 | æœ€å¼ºèƒ½åŠ›ï¼Œä½†ä»·æ ¼é«˜ |
| ç®€å•ä»»åŠ¡ | claude-haiku-3-5-20241022 | æœ€ä¾¿å®œï¼Œé€‚åˆç®€å•æŸ¥è¯¢ |

```python
# æ€§ä»·æ¯”ä¹‹é€‰
options = ClaudeAgentOptions(model='claude-sonnet-4-5-20250929')
```

---

### Q3: å¦‚ä½•æ§åˆ¶Tokenæ¶ˆè€—ï¼Ÿ

**ç­”**ï¼šå‡ ä¸ªæŠ€å·§ï¼š

1. **è®¾ç½®max_turns**ï¼šé™åˆ¶å¯¹è¯è½®æ•°
2. **ç²¾ç®€system_prompt**ï¼šä¸è¦å†™å¤ªé•¿çš„ç³»ç»Ÿæç¤º
3. **ä»»åŠ¡æ˜ç¡®**ï¼šç»™å‡ºæ¸…æ™°å…·ä½“çš„ä»»åŠ¡æè¿°
4. **ä½¿ç”¨æ›´å°çš„æ¨¡å‹**ï¼šç®€å•ä»»åŠ¡ç”¨Haiku

```python
options = ClaudeAgentOptions(
    model='claude-haiku-3-5-20241022',  # ä¾¿å®œæ¨¡å‹
    max_turns=5,  # é™åˆ¶è½®æ•°
    system_prompt="ç®€æ´å›å¤ã€‚"  # ç®€çŸ­æç¤º
)
```

---

### Q4: å­ä»£ç†å’Œä¸»ä»£ç†æ€ä¹ˆé€šä¿¡ï¼Ÿ

**ç­”**ï¼šé€šè¿‡Taskå’ŒTaskOutputå·¥å…·ï¼š

1. ä¸»Agentç”¨Taskå·¥å…·åˆ›å»ºå­ä»£ç†ï¼ŒæŒ‡å®šä»»åŠ¡
2. å­ä»£ç†æ‰§è¡Œä»»åŠ¡å¹¶è¿”å›ç»“æœ
3. ä¸»Agentç”¨TaskOutputå·¥å…·è·å–ç»“æœ

å­ä»£ç†å®Œæˆåï¼Œç»“æœä¼šè‡ªåŠ¨è¿”å›ç»™ä¸»Agentã€‚

---

### Q5: å¯ä»¥åŒæ—¶è¿è¡Œå¤šå°‘ä¸ªå­ä»£ç†ï¼Ÿ

**ç­”**ï¼šæœ€å¤š10ä¸ªå¹¶è¡Œã€‚å¦‚æœéœ€è¦å¤„ç†æ›´å¤šä»»åŠ¡ï¼Œä¼šè‡ªåŠ¨æ’é˜Ÿã€‚

---

### Q6: å¦‚ä½•åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼Ÿ

**ç­”**ï¼šå‡ ä¸ªå»ºè®®ï¼š

1. **ä½¿ç”¨æƒé™æ§åˆ¶**ï¼šè®¾ç½®allowed_toolsç™½åå•
2. **å¯ç”¨æ²™ç®±**ï¼šé˜²æ­¢å±é™©å‘½ä»¤
3. **æ·»åŠ Hooks**ï¼šè®°å½•æ—¥å¿—ã€è¿‡æ»¤å±é™©æ“ä½œ
4. **è®¾ç½®è¶…æ—¶**ï¼šé˜²æ­¢ä»»åŠ¡å¡ä½
5. **ç›‘æ§Tokenæ¶ˆè€—**ï¼šæ§åˆ¶æˆæœ¬

```python
# ç”Ÿäº§ç¯å¢ƒé…ç½®ç¤ºä¾‹
production_options = ClaudeAgentOptions(
    model='claude-sonnet-4-5-20250929',  # æ¨èæ¨¡å‹
    allowed_tools=['Read', 'Glob', 'Grep'],  # æœ€å°æƒé™
    permission_mode='default',  # éœ€è¦ç¡®è®¤
    max_turns=10,
    sandbox={"enabled": True},
    hooks={
        "PreToolUse": [safety_hooks],
        "PostToolUse": [logging_hooks]
    }
)
```

---

### Q7: SDKæ”¯æŒæµå¼è¾“å‡ºå—ï¼Ÿ

**ç­”**ï¼šæ˜¯çš„ï¼`query`å‡½æ•°è¿”å›çš„æ˜¯AsyncIteratorï¼Œå¤©ç„¶æ”¯æŒæµå¼ï¼š

```python
async for message in query(prompt="...", options=options):
    if isinstance(message, AssistantMessage):
        for block in message.content:
            if isinstance(block, TextBlock):
                print(block.text, end='', flush=True)  # æµå¼æ‰“å°
```

---

### Q8: å¦‚ä½•å¤„ç†é•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡ï¼Ÿ

**ç­”**ï¼š

1. **ä½¿ç”¨åå°è¿è¡Œçš„å­ä»£ç†**ï¼šTaskå·¥å…·æ”¯æŒ`run_in_background`
2. **è®¾ç½®åˆç†çš„è¶…æ—¶**
3. **ä½¿ç”¨å¼‚æ­¥å¹¶è¡Œ**

```python
prompt = """è¯·ä½¿ç”¨å­ä»£ç†å¹¶è¡Œå¤„ç†ï¼š
- å­ä»£ç†1ï¼šåˆ†æsrcç›®å½•ï¼ˆrun_in_background: trueï¼‰
- å­ä»£ç†2ï¼šåˆ†ætestsç›®å½•ï¼ˆrun_in_background: trueï¼‰

å¯åŠ¨åç­‰å¾…æ‰€æœ‰å­ä»£ç†å®Œæˆå†æ±‡æ€»ã€‚"""
```

---

### Q9: è‡ªå®šä¹‰å·¥å…·å¯ä»¥è®¿é—®å¤–éƒ¨APIå—ï¼Ÿ

**ç­”**ï¼šå¯ä»¥ï¼è‡ªå®šä¹‰å·¥å…·å°±æ˜¯æ™®é€šçš„Python/TypeScriptå‡½æ•°ï¼š

```python
import httpx

@tool("weather", "è·å–å¤©æ°”ä¿¡æ¯", {"city": str})
async def get_weather(args):
    city = args.get('city')
    async with httpx.AsyncClient() as client:
        response = await client.get(f"https://api.weather.com/{city}")
        data = response.json()

    return {"content": [{"type": "text", "text": f"{city}å¤©æ°”ï¼š{data}"}]}
```

---

### Q10: å¦‚ä½•è°ƒè¯•Agentçš„å†³ç­–è¿‡ç¨‹ï¼Ÿ

**ç­”**ï¼šæ‰“å°æ‰€æœ‰æ¶ˆæ¯ç±»å‹ï¼š

```python
async for message in query(prompt="...", options=options):
    print(f"[{type(message).__name__}] ", end='')

    if isinstance(message, AssistantMessage):
        print("AIæ€è€ƒä¸­...")
        for block in message.content:
            if isinstance(block, TextBlock):
                print(f"  æ–‡æœ¬: {block.text[:100]}...")
            elif isinstance(block, ToolUseBlock):
                print(f"  è°ƒç”¨å·¥å…·: {block.name}({block.input})")

    elif isinstance(message, ToolResultBlock):
        print(f"å·¥å…·ç»“æœ: {str(message.content)[:100]}...")
```

---

### Q11: SDKä¼šè‡ªåŠ¨é‡è¯•å¤±è´¥çš„è¯·æ±‚å—ï¼Ÿ

**ç­”**ï¼šSDKæœ‰åŸºæœ¬çš„é‡è¯•æœºåˆ¶ï¼Œä½†ä½ å¯ä»¥è‡ªå·±åŠ å¼ºï¼š

```python
import asyncio
from tenacity import retry, stop_after_attempt, wait_exponential

@retry(stop=stop_after_attempt(3), wait=wait_exponential(min=1, max=10))
async def query_with_retry(prompt, options):
    results = []
    async for message in query(prompt=prompt, options=options):
        results.append(message)
    return results
```

---

### Q12: å¦‚ä½•åœ¨Jupyter Notebookä¸­ä½¿ç”¨ï¼Ÿ

**ç­”**ï¼šéœ€è¦å¤„ç†äº‹ä»¶å¾ªç¯ï¼š

```python
import nest_asyncio
nest_asyncio.apply()

# ç„¶åæ­£å¸¸ä½¿ç”¨
import asyncio
from claude_agent_sdk import query, ClaudeAgentOptions

async def run():
    async for message in query(prompt="Hello", options=ClaudeAgentOptions()):
        print(message)

asyncio.run(run())
```

---

### Q13: å¯ä»¥ä¿å­˜å’Œæ¢å¤ä¼šè¯å—ï¼Ÿ

**ç­”**ï¼šSDKæœ¬èº«ä¸æä¾›ä¼šè¯æŒä¹…åŒ–ï¼Œä½†ä½ å¯ä»¥è‡ªå·±å®ç°ï¼š

```python
import json

# ä¿å­˜å¯¹è¯å†å²
conversation_history = []

async for message in query(prompt="...", options=options):
    conversation_history.append({
        "type": type(message).__name__,
        "content": str(message)
    })

# ä¿å­˜åˆ°æ–‡ä»¶
with open("session.json", "w") as f:
    json.dump(conversation_history, f)
```

---

### Q14: TypeScriptå’ŒPython SDKåŠŸèƒ½ä¸€æ ·å—ï¼Ÿ

**ç­”**ï¼šæ˜¯çš„ï¼ŒåŠŸèƒ½å®Œå…¨ç›¸åŒã€‚é€‰æ‹©ä½ ç†Ÿæ‚‰çš„è¯­è¨€å³å¯ã€‚

---

### Q15: å¦‚ä½•å¤„ç†å¤§æ–‡ä»¶ï¼Ÿ

**ç­”**ï¼šAgentä¼šè‡ªåŠ¨åˆ†å—å¤„ç†ã€‚å¦‚æœæ–‡ä»¶å¤ªå¤§ï¼Œè€ƒè™‘ï¼š

1. åªè¯»å–éœ€è¦çš„éƒ¨åˆ†
2. ä½¿ç”¨Grepæœç´¢è€Œä¸æ˜¯Readå…¨æ–‡
3. æ‹†åˆ†ä»»åŠ¡ç»™å¤šä¸ªå­ä»£ç†

---

### Q16: SDKæ”¯æŒå“ªäº›AIæ¨¡å‹ï¼Ÿ

**ç­”**ï¼šæ”¯æŒClaudeç³»åˆ—æ¨¡å‹ï¼š

- claude-opus-4-5-20251101ï¼ˆæœ€å¼ºï¼‰
- claude-sonnet-4-5-20250929ï¼ˆæ¨èï¼‰
- claude-haiku-3-5-20241022ï¼ˆæœ€å¿«æœ€ä¾¿å®œï¼‰

é€šè¿‡`model`å‚æ•°æŒ‡å®šï¼š

```python
options = ClaudeAgentOptions(model='claude-sonnet-4-5-20250929')
```

---

### Q17: å¦‚ä½•æµ‹è¯•è‡ªå®šä¹‰å·¥å…·ï¼Ÿ

**ç­”**ï¼šå•ç‹¬æµ‹è¯•å·¥å…·å‡½æ•°ï¼š

```python
# ç›´æ¥è°ƒç”¨æµ‹è¯•
result = await calculate({"expression": "2+2"})
print(result)  # åº”è¯¥è¾“å‡º {"content": [{"type": "text", "text": "2+2 = 4"}]}

# ç„¶ååœ¨Agentä¸­æµ‹è¯•
async for message in query(
    prompt="è¯·è®¡ç®— 2+2",
    options=ClaudeAgentOptions(
        mcp_servers={"tools": my_tools},
        allowed_tools=["mcp__tools__calculate"]
    )
):
    print(message)
```

---

### Q18: å¦‚ä½•å¤„ç†APIé€Ÿç‡é™åˆ¶ï¼Ÿ

**ç­”**ï¼š

1. æ·»åŠ è¯·æ±‚é—´éš”
2. ä½¿ç”¨æŒ‡æ•°é€€é¿é‡è¯•
3. ç›‘æ§é€Ÿç‡é™åˆ¶é”™è¯¯

```python
import asyncio

async def rate_limited_query(prompts, delay=1.0):
    for prompt in prompts:
        async for message in query(prompt=prompt, options=options):
            yield message
        await asyncio.sleep(delay)  # è¯·æ±‚é—´éš”
```

---

### Q19: å®‰å…¨æœ€ä½³å®è·µæœ‰å“ªäº›ï¼Ÿ

**ç­”**ï¼š

1. **æœ€å°æƒé™åŸåˆ™**ï¼šåªç»™éœ€è¦çš„å·¥å…·æƒé™
2. **è¾“å…¥éªŒè¯**ï¼šè‡ªå®šä¹‰å·¥å…·è¦éªŒè¯è¾“å…¥
3. **ä¸ä¿¡ä»»ç”¨æˆ·è¾“å…¥**ï¼šAgentçš„promptå¯èƒ½è¢«æ³¨å…¥
4. **å¯ç”¨æ²™ç®±**ï¼šBashå‘½ä»¤åœ¨æ²™ç®±ä¸­æ‰§è¡Œ
5. **ä½¿ç”¨Hooksè¿‡æ»¤**ï¼šé˜»æ­¢å±é™©æ“ä½œ
6. **ç›‘æ§æ—¥å¿—**ï¼šè®°å½•æ‰€æœ‰å·¥å…·è°ƒç”¨

---

### Q20: æœ‰å®˜æ–¹ç¤ºä¾‹ä»£ç å—ï¼Ÿ

**ç­”**ï¼šæœ‰ï¼

- **Pythonç¤ºä¾‹**ï¼šhttps://github.com/anthropics/claude-agent-sdk-python/tree/main/examples
- **TypeScriptç¤ºä¾‹**ï¼šhttps://github.com/anthropics/claude-agent-sdk-typescript/tree/main/examples

æ¨èä»`quick_start.py`æˆ–`quick_start.ts`å¼€å§‹ã€‚

---

## æœ¬è¯¾æ€»ç»“

### æ ¸å¿ƒçŸ¥è¯†ç‚¹å›é¡¾

1. **Agent SDKå®šä½**ï¼šæŠŠClaude Codeçš„èƒ½åŠ›å°è£…ä¸ºå¯ç¼–ç¨‹æ¥å£
2. **queryå‡½æ•°**ï¼šæ ¸å¿ƒAPIï¼Œè¿”å›æµå¼æ¶ˆæ¯
3. **Agent Loop**ï¼šæ¥æ”¶â†’æ€è€ƒâ†’ä½¿ç”¨å·¥å…·â†’æ£€æŸ¥â†’ç»§ç»­/ç»“æŸ
4. **Tools**ï¼šAgentçš„èƒ½åŠ›æ¥æºï¼Œå¯ä»¥è‡ªå®šä¹‰æ‰©å±•
5. **Subagents**ï¼šå¹¶è¡Œå¤„ç†å¤æ‚ä»»åŠ¡
6. **Hooks**ï¼šåœ¨å…³é”®æ—¶åˆ»è‡ªåŠ¨æ‰§è¡Œè‡ªå®šä¹‰é€»è¾‘

### æœ€ä½³å®è·µæ€»ç»“

| åœºæ™¯ | å»ºè®® |
|------|------|
| æ¨¡å‹é€‰æ‹© | æ—¥å¸¸ç”¨Sonnetï¼Œå¤æ‚æ¨ç†ç”¨Opusï¼Œç®€å•ä»»åŠ¡ç”¨Haiku |
| æƒé™æ§åˆ¶ | ç”Ÿäº§ç¯å¢ƒç”¨æœ€å°æƒé™ï¼Œå¼€å‘å¯ä»¥æ”¾å®½ |
| å­ä»£ç† | å¤§ä»»åŠ¡æ‹†åˆ†å¹¶è¡Œï¼Œæ³¨æ„æœ€å¤š10ä¸ªåŒæ—¶è¿è¡Œ |
| è‡ªå®šä¹‰å·¥å…· | ä¼˜å…ˆç”¨SDKå†…ç½®MCPæœåŠ¡å™¨ï¼Œç®€å•é«˜æ•ˆ |
| é”™è¯¯å¤„ç† | ä½¿ç”¨try/catchï¼Œæ·»åŠ é‡è¯•æœºåˆ¶ |

### ä¸‹ä¸€æ­¥å­¦ä¹ 

å®Œæˆæœ¬è¯¾åï¼Œå»ºè®®ç»§ç»­å­¦ä¹ ï¼š

1. **MCPå¼€å‘**ï¼šæ·±å…¥å­¦ä¹ MCPåè®®ï¼Œåˆ›å»ºæ›´å¤æ‚çš„å·¥å…·
2. **Hooksé«˜çº§åº”ç”¨**ï¼šå®ç°è‡ªåŠ¨æµ‹è¯•ã€è‡ªåŠ¨æ ¼å¼åŒ–ç­‰å·¥ä½œæµ
3. **ä¼ä¸šé›†æˆ**ï¼šå°†Agent SDKé›†æˆåˆ°CI/CDæµç¨‹

---

**è¯¾ç¨‹ç‰ˆæœ¬**ï¼šV1.1
**æœ€åæ›´æ–°**ï¼š2026å¹´2æœˆ25æ—¥
**ä½œè€…**ï¼šClaude Codeæ•™ç¨‹å›¢é˜Ÿ

---

## ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | ä¿®æ”¹å†…å®¹ |
|------|------|----------|
| V1.1 | 2025-12-24 | ä¿®æ­£æ‰€æœ‰æ¨¡å‹åç§°ä¸ºæœ€æ–°4.5ç‰ˆæœ¬ï¼ˆclaude-sonnet-4-5-20250929ã€claude-opus-4-5-20251101ã€claude-haiku-3-5-20241022ï¼‰ |
| V1.0 | 2025-12-19 | åˆç‰ˆå‘å¸ƒ |

**å‚è€ƒèµ„æ–™**ï¼š
- [å®˜æ–¹Python SDKæ–‡æ¡£](https://docs.anthropic.com/en/docs/claude-code/sdk/sdk-python)
- [å®˜æ–¹TypeScript SDKæ–‡æ¡£](https://docs.anthropic.com/en/docs/claude-code/sdk/sdk-typescript)
- [GitHub Python SDK](https://github.com/anthropics/claude-agent-sdk-python)
- [GitHub TypeScript SDK](https://github.com/anthropics/claude-agent-sdk-typescript)
- [DataCampæ•™ç¨‹](https://www.datacamp.com/tutorial/how-to-use-claude-agent-sdk)
- [KDnuggetså…¥é—¨æŒ‡å—](https://www.kdnuggets.com/getting-started-with-the-claude-agent-sdk)
